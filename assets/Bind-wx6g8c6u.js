(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))d(p);new MutationObserver(p=>{for(const w of p)if(w.type==="childList")for(const h of w.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&d(h)}).observe(document,{childList:!0,subtree:!0});function a(p){const w={};return p.integrity&&(w.integrity=p.integrity),p.referrerPolicy&&(w.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?w.credentials="include":p.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function d(p){if(p.ep)return;p.ep=!0;const w=a(p);fetch(p.href,w)}})();/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Ut=globalThis,qt=Ut.ShadowRoot&&(Ut.ShadyCSS===void 0||Ut.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Wt=Symbol(),Jt=new WeakMap;let fn=class{constructor(n,a,d){if(this._$cssResult$=!0,d!==Wt)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=n,this.t=a}get styleSheet(){let n=this.o;const a=this.t;if(qt&&n===void 0){const d=a!==void 0&&a.length===1;d&&(n=Jt.get(a)),n===void 0&&((this.o=n=new CSSStyleSheet).replaceSync(this.cssText),d&&Jt.set(a,n))}return n}toString(){return this.cssText}};const wn=_=>new fn(typeof _=="string"?_:_+"",void 0,Wt),Yn=(_,...n)=>{const a=_.length===1?_[0]:n.reduce((d,p,w)=>d+(h=>{if(h._$cssResult$===!0)return h.cssText;if(typeof h=="number")return h;throw Error("Value passed to 'css' function must be a 'css' function result: "+h+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(p)+_[w+1],_[0]);return new fn(a,_,Wt)},An=(_,n)=>{if(qt)_.adoptedStyleSheets=n.map(a=>a instanceof CSSStyleSheet?a:a.styleSheet);else for(const a of n){const d=document.createElement("style"),p=Ut.litNonce;p!==void 0&&d.setAttribute("nonce",p),d.textContent=a.cssText,_.appendChild(d)}},Zt=qt?_=>_:_=>_ instanceof CSSStyleSheet?(n=>{let a="";for(const d of n.cssRules)a+=d.cssText;return wn(a)})(_):_;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const{is:kn,defineProperty:En,getOwnPropertyDescriptor:_n,getOwnPropertyNames:$n,getOwnPropertySymbols:Sn,getPrototypeOf:Pn}=Object,nt=globalThis,Xt=nt.trustedTypes,Tn=Xt?Xt.emptyScript:"",It=nt.reactiveElementPolyfillSupport,At=(_,n)=>_,Nt={toAttribute(_,n){switch(n){case Boolean:_=_?Tn:null;break;case Object:case Array:_=_==null?_:JSON.stringify(_)}return _},fromAttribute(_,n){let a=_;switch(n){case Boolean:a=_!==null;break;case Number:a=_===null?null:Number(_);break;case Object:case Array:try{a=JSON.parse(_)}catch{a=null}}return a}},Bt=(_,n)=>!kn(_,n),Qt={attribute:!0,type:String,converter:Nt,reflect:!1,hasChanged:Bt};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),nt.litPropertyMetadata??(nt.litPropertyMetadata=new WeakMap);class dt extends HTMLElement{static addInitializer(n){this._$Ei(),(this.l??(this.l=[])).push(n)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(n,a=Qt){if(a.state&&(a.attribute=!1),this._$Ei(),this.elementProperties.set(n,a),!a.noAccessor){const d=Symbol(),p=this.getPropertyDescriptor(n,d,a);p!==void 0&&En(this.prototype,n,p)}}static getPropertyDescriptor(n,a,d){const{get:p,set:w}=_n(this.prototype,n)??{get(){return this[a]},set(h){this[a]=h}};return{get(){return p==null?void 0:p.call(this)},set(h){const U=p==null?void 0:p.call(this);w.call(this,h),this.requestUpdate(n,U,d)},configurable:!0,enumerable:!0}}static getPropertyOptions(n){return this.elementProperties.get(n)??Qt}static _$Ei(){if(this.hasOwnProperty(At("elementProperties")))return;const n=Pn(this);n.finalize(),n.l!==void 0&&(this.l=[...n.l]),this.elementProperties=new Map(n.elementProperties)}static finalize(){if(this.hasOwnProperty(At("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(At("properties"))){const a=this.properties,d=[...$n(a),...Sn(a)];for(const p of d)this.createProperty(p,a[p])}const n=this[Symbol.metadata];if(n!==null){const a=litPropertyMetadata.get(n);if(a!==void 0)for(const[d,p]of a)this.elementProperties.set(d,p)}this._$Eh=new Map;for(const[a,d]of this.elementProperties){const p=this._$Eu(a,d);p!==void 0&&this._$Eh.set(p,a)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(n){const a=[];if(Array.isArray(n)){const d=new Set(n.flat(1/0).reverse());for(const p of d)a.unshift(Zt(p))}else n!==void 0&&a.push(Zt(n));return a}static _$Eu(n,a){const d=a.attribute;return d===!1?void 0:typeof d=="string"?d:typeof n=="string"?n.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var n;this._$ES=new Promise(a=>this.enableUpdating=a),this._$AL=new Map,this._$E_(),this.requestUpdate(),(n=this.constructor.l)==null||n.forEach(a=>a(this))}addController(n){var a;(this._$EO??(this._$EO=new Set)).add(n),this.renderRoot!==void 0&&this.isConnected&&((a=n.hostConnected)==null||a.call(n))}removeController(n){var a;(a=this._$EO)==null||a.delete(n)}_$E_(){const n=new Map,a=this.constructor.elementProperties;for(const d of a.keys())this.hasOwnProperty(d)&&(n.set(d,this[d]),delete this[d]);n.size>0&&(this._$Ep=n)}createRenderRoot(){const n=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return An(n,this.constructor.elementStyles),n}connectedCallback(){var n;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(n=this._$EO)==null||n.forEach(a=>{var d;return(d=a.hostConnected)==null?void 0:d.call(a)})}enableUpdating(n){}disconnectedCallback(){var n;(n=this._$EO)==null||n.forEach(a=>{var d;return(d=a.hostDisconnected)==null?void 0:d.call(a)})}attributeChangedCallback(n,a,d){this._$AK(n,d)}_$EC(n,a){var w;const d=this.constructor.elementProperties.get(n),p=this.constructor._$Eu(n,d);if(p!==void 0&&d.reflect===!0){const h=(((w=d.converter)==null?void 0:w.toAttribute)!==void 0?d.converter:Nt).toAttribute(a,d.type);this._$Em=n,h==null?this.removeAttribute(p):this.setAttribute(p,h),this._$Em=null}}_$AK(n,a){var w;const d=this.constructor,p=d._$Eh.get(n);if(p!==void 0&&this._$Em!==p){const h=d.getPropertyOptions(p),U=typeof h.converter=="function"?{fromAttribute:h.converter}:((w=h.converter)==null?void 0:w.fromAttribute)!==void 0?h.converter:Nt;this._$Em=p,this[p]=U.fromAttribute(a,h.type),this._$Em=null}}requestUpdate(n,a,d){if(n!==void 0){if(d??(d=this.constructor.getPropertyOptions(n)),!(d.hasChanged??Bt)(this[n],a))return;this.P(n,a,d)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(n,a,d){this._$AL.has(n)||this._$AL.set(n,a),d.reflect===!0&&this._$Em!==n&&(this._$Ej??(this._$Ej=new Set)).add(n)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(a){Promise.reject(a)}const n=this.scheduleUpdate();return n!=null&&await n,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var d;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[w,h]of this._$Ep)this[w]=h;this._$Ep=void 0}const p=this.constructor.elementProperties;if(p.size>0)for(const[w,h]of p)h.wrapped!==!0||this._$AL.has(w)||this[w]===void 0||this.P(w,this[w],h)}let n=!1;const a=this._$AL;try{n=this.shouldUpdate(a),n?(this.willUpdate(a),(d=this._$EO)==null||d.forEach(p=>{var w;return(w=p.hostUpdate)==null?void 0:w.call(p)}),this.update(a)):this._$EU()}catch(p){throw n=!1,this._$EU(),p}n&&this._$AE(a)}willUpdate(n){}_$AE(n){var a;(a=this._$EO)==null||a.forEach(d=>{var p;return(p=d.hostUpdated)==null?void 0:p.call(d)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(n)),this.updated(n)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(n){return!0}update(n){this._$Ej&&(this._$Ej=this._$Ej.forEach(a=>this._$EC(a,this[a]))),this._$EU()}updated(n){}firstUpdated(n){}}dt.elementStyles=[],dt.shadowRootOptions={mode:"open"},dt[At("elementProperties")]=new Map,dt[At("finalized")]=new Map,It==null||It({ReactiveElement:dt}),(nt.reactiveElementVersions??(nt.reactiveElementVersions=[])).push("2.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const kt=globalThis,Ft=kt.trustedTypes,Kt=Ft?Ft.createPolicy("lit-html",{createHTML:_=>_}):void 0,cn="$lit$",tt=`lit$${(Math.random()+"").slice(9)}$`,ln="?"+tt,Dn=`<${ln}>`,ot=document,Et=()=>ot.createComment(""),_t=_=>_===null||typeof _!="object"&&typeof _!="function",dn=Array.isArray,On=_=>dn(_)||typeof(_==null?void 0:_[Symbol.iterator])=="function",Lt=`[ 	
\f\r]`,wt=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,en=/-->/g,tn=/>/g,at=RegExp(`>|${Lt}(?:([^\\s"'>=/]+)(${Lt}*=${Lt}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),nn=/'/g,rn=/"/g,hn=/^(?:script|style|textarea|title)$/i,xn=_=>(n,...a)=>({_$litType$:_,strings:n,values:a}),Vn=xn(1),pt=Symbol.for("lit-noChange"),xe=Symbol.for("lit-nothing"),an=new WeakMap,st=ot.createTreeWalker(ot,129);function pn(_,n){if(!Array.isArray(_)||!_.hasOwnProperty("raw"))throw Error("invalid template strings array");return Kt!==void 0?Kt.createHTML(n):n}const Cn=(_,n)=>{const a=_.length-1,d=[];let p,w=n===2?"<svg>":"",h=wt;for(let U=0;U<a;U++){const N=_[U];let G,X,$=-1,k=0;for(;k<N.length&&(h.lastIndex=k,X=h.exec(N),X!==null);)k=h.lastIndex,h===wt?X[1]==="!--"?h=en:X[1]!==void 0?h=tn:X[2]!==void 0?(hn.test(X[2])&&(p=RegExp("</"+X[2],"g")),h=at):X[3]!==void 0&&(h=at):h===at?X[0]===">"?(h=p??wt,$=-1):X[1]===void 0?$=-2:($=h.lastIndex-X[2].length,G=X[1],h=X[3]===void 0?at:X[3]==='"'?rn:nn):h===rn||h===nn?h=at:h===en||h===tn?h=wt:(h=at,p=void 0);const E=h===at&&_[U+1].startsWith("/>")?" ":"";w+=h===wt?N+Dn:$>=0?(d.push(G),N.slice(0,$)+cn+N.slice($)+tt+E):N+tt+($===-2?U:E)}return[pn(_,w+(_[a]||"<?>")+(n===2?"</svg>":"")),d]};class $t{constructor({strings:n,_$litType$:a},d){let p;this.parts=[];let w=0,h=0;const U=n.length-1,N=this.parts,[G,X]=Cn(n,a);if(this.el=$t.createElement(G,d),st.currentNode=this.el.content,a===2){const $=this.el.content.firstChild;$.replaceWith(...$.childNodes)}for(;(p=st.nextNode())!==null&&N.length<U;){if(p.nodeType===1){if(p.hasAttributes())for(const $ of p.getAttributeNames())if($.endsWith(cn)){const k=X[h++],E=p.getAttribute($).split(tt),F=/([.?@])?(.*)/.exec(k);N.push({type:1,index:w,name:F[2],strings:E,ctor:F[1]==="."?Un:F[1]==="?"?Nn:F[1]==="@"?Fn:Rt}),p.removeAttribute($)}else $.startsWith(tt)&&(N.push({type:6,index:w}),p.removeAttribute($));if(hn.test(p.tagName)){const $=p.textContent.split(tt),k=$.length-1;if(k>0){p.textContent=Ft?Ft.emptyScript:"";for(let E=0;E<k;E++)p.append($[E],Et()),st.nextNode(),N.push({type:2,index:++w});p.append($[k],Et())}}}else if(p.nodeType===8)if(p.data===ln)N.push({type:2,index:w});else{let $=-1;for(;($=p.data.indexOf(tt,$+1))!==-1;)N.push({type:7,index:w}),$+=tt.length-1}w++}}static createElement(n,a){const d=ot.createElement("template");return d.innerHTML=n,d}}function vt(_,n,a=_,d){var h,U;if(n===pt)return n;let p=d!==void 0?(h=a._$Co)==null?void 0:h[d]:a._$Cl;const w=_t(n)?void 0:n._$litDirective$;return(p==null?void 0:p.constructor)!==w&&((U=p==null?void 0:p._$AO)==null||U.call(p,!1),w===void 0?p=void 0:(p=new w(_),p._$AT(_,a,d)),d!==void 0?(a._$Co??(a._$Co=[]))[d]=p:a._$Cl=p),p!==void 0&&(n=vt(_,p._$AS(_,n.values),p,d)),n}class Mn{constructor(n,a){this._$AV=[],this._$AN=void 0,this._$AD=n,this._$AM=a}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(n){const{el:{content:a},parts:d}=this._$AD,p=((n==null?void 0:n.creationScope)??ot).importNode(a,!0);st.currentNode=p;let w=st.nextNode(),h=0,U=0,N=d[0];for(;N!==void 0;){if(h===N.index){let G;N.type===2?G=new St(w,w.nextSibling,this,n):N.type===1?G=new N.ctor(w,N.name,N.strings,this,n):N.type===6&&(G=new jn(w,this,n)),this._$AV.push(G),N=d[++U]}h!==(N==null?void 0:N.index)&&(w=st.nextNode(),h++)}return st.currentNode=ot,p}p(n){let a=0;for(const d of this._$AV)d!==void 0&&(d.strings!==void 0?(d._$AI(n,d,a),a+=d.strings.length-2):d._$AI(n[a])),a++}}class St{get _$AU(){var n;return((n=this._$AM)==null?void 0:n._$AU)??this._$Cv}constructor(n,a,d,p){this.type=2,this._$AH=xe,this._$AN=void 0,this._$AA=n,this._$AB=a,this._$AM=d,this.options=p,this._$Cv=(p==null?void 0:p.isConnected)??!0}get parentNode(){let n=this._$AA.parentNode;const a=this._$AM;return a!==void 0&&(n==null?void 0:n.nodeType)===11&&(n=a.parentNode),n}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(n,a=this){n=vt(this,n,a),_t(n)?n===xe||n==null||n===""?(this._$AH!==xe&&this._$AR(),this._$AH=xe):n!==this._$AH&&n!==pt&&this._(n):n._$litType$!==void 0?this.$(n):n.nodeType!==void 0?this.T(n):On(n)?this.k(n):this._(n)}S(n){return this._$AA.parentNode.insertBefore(n,this._$AB)}T(n){this._$AH!==n&&(this._$AR(),this._$AH=this.S(n))}_(n){this._$AH!==xe&&_t(this._$AH)?this._$AA.nextSibling.data=n:this.T(ot.createTextNode(n)),this._$AH=n}$(n){var w;const{values:a,_$litType$:d}=n,p=typeof d=="number"?this._$AC(n):(d.el===void 0&&(d.el=$t.createElement(pn(d.h,d.h[0]),this.options)),d);if(((w=this._$AH)==null?void 0:w._$AD)===p)this._$AH.p(a);else{const h=new Mn(p,this),U=h.u(this.options);h.p(a),this.T(U),this._$AH=h}}_$AC(n){let a=an.get(n.strings);return a===void 0&&an.set(n.strings,a=new $t(n)),a}k(n){dn(this._$AH)||(this._$AH=[],this._$AR());const a=this._$AH;let d,p=0;for(const w of n)p===a.length?a.push(d=new St(this.S(Et()),this.S(Et()),this,this.options)):d=a[p],d._$AI(w),p++;p<a.length&&(this._$AR(d&&d._$AB.nextSibling,p),a.length=p)}_$AR(n=this._$AA.nextSibling,a){var d;for((d=this._$AP)==null?void 0:d.call(this,!1,!0,a);n&&n!==this._$AB;){const p=n.nextSibling;n.remove(),n=p}}setConnected(n){var a;this._$AM===void 0&&(this._$Cv=n,(a=this._$AP)==null||a.call(this,n))}}class Rt{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(n,a,d,p,w){this.type=1,this._$AH=xe,this._$AN=void 0,this.element=n,this.name=a,this._$AM=p,this.options=w,d.length>2||d[0]!==""||d[1]!==""?(this._$AH=Array(d.length-1).fill(new String),this.strings=d):this._$AH=xe}_$AI(n,a=this,d,p){const w=this.strings;let h=!1;if(w===void 0)n=vt(this,n,a,0),h=!_t(n)||n!==this._$AH&&n!==pt,h&&(this._$AH=n);else{const U=n;let N,G;for(n=w[0],N=0;N<w.length-1;N++)G=vt(this,U[d+N],a,N),G===pt&&(G=this._$AH[N]),h||(h=!_t(G)||G!==this._$AH[N]),G===xe?n=xe:n!==xe&&(n+=(G??"")+w[N+1]),this._$AH[N]=G}h&&!p&&this.j(n)}j(n){n===xe?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,n??"")}}class Un extends Rt{constructor(){super(...arguments),this.type=3}j(n){this.element[this.name]=n===xe?void 0:n}}class Nn extends Rt{constructor(){super(...arguments),this.type=4}j(n){this.element.toggleAttribute(this.name,!!n&&n!==xe)}}class Fn extends Rt{constructor(n,a,d,p,w){super(n,a,d,p,w),this.type=5}_$AI(n,a=this){if((n=vt(this,n,a,0)??xe)===pt)return;const d=this._$AH,p=n===xe&&d!==xe||n.capture!==d.capture||n.once!==d.once||n.passive!==d.passive,w=n!==xe&&(d===xe||p);p&&this.element.removeEventListener(this.name,this,d),w&&this.element.addEventListener(this.name,this,n),this._$AH=n}handleEvent(n){var a;typeof this._$AH=="function"?this._$AH.call(((a=this.options)==null?void 0:a.host)??this.element,n):this._$AH.handleEvent(n)}}class jn{constructor(n,a,d){this.element=n,this.type=6,this._$AN=void 0,this._$AM=a,this.options=d}get _$AU(){return this._$AM._$AU}_$AI(n){vt(this,n)}}const zt=kt.litHtmlPolyfillSupport;zt==null||zt($t,St),(kt.litHtmlVersions??(kt.litHtmlVersions=[])).push("3.1.2");const Rn=(_,n,a)=>{const d=(a==null?void 0:a.renderBefore)??n;let p=d._$litPart$;if(p===void 0){const w=(a==null?void 0:a.renderBefore)??null;d._$litPart$=p=new St(n.insertBefore(Et(),w),w,void 0,a??{})}return p._$AI(_),p};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class ht extends dt{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var a;const n=super.createRenderRoot();return(a=this.renderOptions).renderBefore??(a.renderBefore=n.firstChild),n}update(n){const a=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(n),this._$Do=Rn(a,this.renderRoot,this.renderOptions)}connectedCallback(){var n;super.connectedCallback(),(n=this._$Do)==null||n.setConnected(!0)}disconnectedCallback(){var n;super.disconnectedCallback(),(n=this._$Do)==null||n.setConnected(!1)}render(){return pt}}var un;ht._$litElement$=!0,ht.finalized=!0,(un=globalThis.litElementHydrateSupport)==null||un.call(globalThis,{LitElement:ht});const Ht=globalThis.litElementPolyfillSupport;Ht==null||Ht({LitElement:ht});(globalThis.litElementVersions??(globalThis.litElementVersions=[])).push("4.0.4");/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Gn=_=>(n,a)=>{a!==void 0?a.addInitializer(()=>{customElements.define(_,n)}):customElements.define(_,n)};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const In={attribute:!0,type:String,converter:Nt,reflect:!1,hasChanged:Bt},Ln=(_=In,n,a)=>{const{kind:d,metadata:p}=a;let w=globalThis.litPropertyMetadata.get(p);if(w===void 0&&globalThis.litPropertyMetadata.set(p,w=new Map),w.set(a.name,_),d==="accessor"){const{name:h}=a;return{set(U){const N=n.get.call(this);n.set.call(this,U),this.requestUpdate(h,N,_)},init(U){return U!==void 0&&this.P(h,void 0,_),U}}}if(d==="setter"){const{name:h}=a;return function(U){const N=this[h];n.call(this,U),this.requestUpdate(h,N,_)}}throw Error("Unsupported decorator location: "+d)};function zn(_){return(n,a)=>typeof a=="object"?Ln(_,n,a):((d,p,w)=>{const h=p.hasOwnProperty(w);return p.constructor.createProperty(w,h?{...d,wrapped:!0}:d),h?Object.getOwnPropertyDescriptor(p,w):void 0})(_,n,a)}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function Jn(_){return zn({..._,state:!0,attribute:!1})}var sn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Hn(_){return _&&_.__esModule&&Object.prototype.hasOwnProperty.call(_,"default")?_.default:_}function Mt(_){throw new Error('Could not dynamically require "'+_+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var vn={exports:{}};(function(_,n){(function(a){_.exports=a()})(function(){return function(){function a(d,p,w){function h(G,X){if(!p[G]){if(!d[G]){var $=typeof Mt=="function"&&Mt;if(!X&&$)return $(G,!0);if(U)return U(G,!0);var k=new Error("Cannot find module '"+G+"'");throw k.code="MODULE_NOT_FOUND",k}var E=p[G]={exports:{}};d[G][0].call(E.exports,function(F){var oe=d[G][1][F];return h(oe||F)},E,E.exports,a,d,p,w)}return p[G].exports}for(var U=typeof Mt=="function"&&Mt,N=0;N<w.length;N++)h(w[N]);return h}return a}()({1:[function(a,d,p){const w=a("./utils"),h=function(){const U=w.stringToArray,N=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],G=["Zeroth","First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth","Eleventh","Twelfth","Thirteenth","Fourteenth","Fifteenth","Sixteenth","Seventeenth","Eighteenth","Nineteenth"],X=["Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety","Hundred"],$=["Thousand","Million","Billion","Trillion"];function k(v,b){var y=function(O,D,A){var x="";if(O<=19)x=(D?" and ":"")+(A?G[O]:N[O]);else if(O<100){const re=Math.floor(O/10),ae=O%10;x=(D?" and ":"")+X[re-2],ae>0?x+="-"+y(ae,!1,A):A&&(x=x.substring(0,x.length-1)+"ieth")}else if(O<1e3){const re=Math.floor(O/100),ae=O%100;x=(D?", ":"")+N[re]+" Hundred",ae>0?x+=y(ae,!0,A):A&&(x+="th")}else{var q=Math.floor(Math.log10(O)/3);q>$.length&&(q=$.length);const re=Math.pow(10,q*3),ae=Math.floor(O/re),H=O-ae*re;x=(D?", ":"")+y(ae,!1,!1)+" "+$[q-1],H>0?x+=y(H,!0,A):A&&(x+="th")}return x},P=y(v,!1,b);return P}const E={};N.forEach(function(v,b){E[v.toLowerCase()]=b}),G.forEach(function(v,b){E[v.toLowerCase()]=b}),X.forEach(function(v,b){const y=v.toLowerCase();E[y]=(b+2)*10,E[y.substring(0,v.length-1)+"ieth"]=E[y]}),E.hundredth=100,$.forEach(function(v,b){const y=v.toLowerCase(),P=Math.pow(10,(b+1)*3);E[y]=P,E[y+"th"]=P});function F(v){const y=v.split(/,\s|\sand\s|[\s\\-]/).map(D=>E[D]);let P=[0];return y.forEach(D=>{if(D<100){let A=P.pop();A>=1e3&&(P.push(A),A=0),P.push(A+D)}else P.push(P.pop()*D)}),P.reduce((D,A)=>D+A,0)}const oe=[[1e3,"m"],[900,"cm"],[500,"d"],[400,"cd"],[100,"c"],[90,"xc"],[50,"l"],[40,"xl"],[10,"x"],[9,"ix"],[5,"v"],[4,"iv"],[1,"i"]],we={M:1e3,D:500,C:100,L:50,X:10,V:5,I:1};function me(v){for(var b=0;b<oe.length;b++){const y=oe[b];if(v>=y[0])return y[1]+me(v-y[0])}return""}function B(v){for(var b=0,y=1,P=v.length-1;P>=0;P--){const O=v[P],D=we[O];D<y?b-=D:(y=D,b+=D)}return b}function S(v,b){for(var y=[],P=b.charCodeAt(0);v>0;)y.unshift(String.fromCharCode((v-1)%26+P)),v=Math.floor((v-1)/26);return y.join("")}function Z(v,b){for(var y=b.charCodeAt(0),P=0,O=0;O<v.length;O++)P+=(v.charCodeAt(v.length-O-1)-y+1)*Math.pow(26,O);return P}function j(v,b){if(typeof v>"u")return;v=Math.floor(v);const y=ue(b);return L(v,y)}const m={DECIMAL:"decimal",LETTERS:"letters",ROMAN:"roman",WORDS:"words",SEQUENCE:"sequence"},C={UPPER:"upper",LOWER:"lower",TITLE:"title"};function L(v,b){let y;const P=v<0;switch(v=Math.abs(v),b.primary){case m.LETTERS:y=S(v,b.case===C.UPPER?"A":"a");break;case m.ROMAN:y=me(v),b.case===C.UPPER&&(y=y.toUpperCase());break;case m.WORDS:y=k(v,b.ordinal),b.case===C.UPPER?y=y.toUpperCase():b.case===C.LOWER&&(y=y.toLowerCase());break;case m.DECIMAL:y=""+v;var O=b.mandatoryDigits-y.length;if(O>0){var D=new Array(O+1).join("0");y=D+y}if(b.zeroCode!==48&&(y=U(y).map(re=>String.fromCodePoint(re.codePointAt(0)+b.zeroCode-48)).join("")),b.regular){const re=Math.floor((y.length-1)/b.groupingSeparators.position);for(let ae=re;ae>0;ae--){const H=y.length-ae*b.groupingSeparators.position;y=y.substr(0,H)+b.groupingSeparators.character+y.substr(H)}}else b.groupingSeparators.reverse().forEach(re=>{const ae=y.length-re.position;y=y.substr(0,ae)+re.character+y.substr(ae)});if(b.ordinal){var A={1:"st",2:"nd",3:"rd"},x=y[y.length-1],q=A[x];(!q||y.length>1&&y[y.length-2]==="1")&&(q="th"),y=y+q}break;case m.SEQUENCE:throw{code:"D3130",value:b.token}}return P&&(y="-"+y),y}const te=[48,1632,1776,1984,2406,2534,2662,2790,2918,3046,3174,3302,3430,3558,3664,3792,3872,4160,4240,6112,6160,6470,6608,6784,6800,6992,7088,7232,7248,42528,43216,43264,43472,43504,43600,44016,65296];function ue(v){const b={type:"integer",primary:m.DECIMAL,case:C.LOWER,ordinal:!1};let y,P;const O=v.lastIndexOf(";");switch(O===-1?y=v:(y=v.substring(0,O),P=v.substring(O+1),P[0]==="o"&&(b.ordinal=!0)),y){case"A":b.case=C.UPPER;case"a":b.primary=m.LETTERS;break;case"I":b.case=C.UPPER;case"i":b.primary=m.ROMAN;break;case"W":b.case=C.UPPER,b.primary=m.WORDS;break;case"Ww":b.case=C.TITLE,b.primary=m.WORDS;break;case"w":b.primary=m.WORDS;break;default:{let D=null,A=0,x=0,q=[],re=0;if(U(y).map(H=>H.codePointAt(0)).reverse().forEach(H=>{let Y=!1;for(let le=0;le<te.length;le++){const z=te[le];if(H>=z&&H<=z+9){if(Y=!0,A++,re++,D===null)D=z;else if(z!==D)throw{code:"D3131"};break}}Y||(H===35?(re++,x++):q.push({position:re,character:String.fromCodePoint(H)}))}),A>0){b.primary=m.DECIMAL,b.zeroCode=D,b.mandatoryDigits=A,b.optionalDigits=x;const Y=function(le){if(le.length===0)return 0;const z=le[0].character;for(let Pe=1;Pe<le.length;Pe++)if(le[Pe].character!==z)return 0;const De=le.map(Pe=>Pe.position),Be=function(Pe,Ne){return Ne===0?Pe:Be(Ne,Pe%Ne)},Ue=De.reduce(Be);for(let Pe=1;Pe<=De.length;Pe++)if(De.indexOf(Pe*Ue)===-1)return 0;return Ue}(q);Y>0?(b.regular=!0,b.groupingSeparators={position:Y,character:q[0].character}):(b.regular=!1,b.groupingSeparators=q)}else b.primary=m.SEQUENCE,b.token=y}}return b}const de={Y:"1",M:"1",D:"1",d:"1",F:"n",W:"1",w:"1",X:"1",x:"1",H:"1",h:"1",P:"n",m:"01",s:"01",f:"1",Z:"01:01",z:"01:01",C:"n",E:"n"};function he(v){var b=[];const y={type:"datetime",parts:b},P=function(Y,le){if(le>Y){let z=v.substring(Y,le);z=z.split("]]").join("]"),b.push({type:"literal",value:z})}};for(var O=0,D=0;D<v.length;){if(v.charAt(D)==="["){if(v.charAt(D+1)==="["){P(O,D),b.push({type:"literal",value:"["}),D+=2,O=D;continue}if(P(O,D),O=D,D=v.indexOf("]",O),D===-1)throw{code:"D3135"};let Y=v.substring(O+1,D);Y=Y.split(/\s+/).join("");var A={type:"marker",component:Y.charAt(0)},x=Y.lastIndexOf(","),q;if(x!==-1){const le=Y.substring(x+1),z=le.indexOf("-");let De,Be;const Ue=function(Ne){if(!(typeof Ne>"u"||Ne==="*"))return parseInt(Ne)};z===-1?De=le:(De=le.substring(0,z),Be=le.substring(z+1));const Pe={min:Ue(De),max:Ue(Be)};A.width=Pe,q=Y.substring(1,x)}else q=Y.substring(1);if(q.length===1)A.presentation1=q;else if(q.length>1){var re=q.charAt(q.length-1);"atco".indexOf(re)!==-1?(A.presentation2=re,re==="o"&&(A.ordinal=!0),A.presentation1=q.substring(0,q.length-1)):A.presentation1=q}else A.presentation1=de[A.component];if(typeof A.presentation1>"u")throw{code:"D3132",value:A.component};if(A.presentation1[0]==="n")A.names=C.LOWER;else if(A.presentation1[0]==="N")A.presentation1[1]==="n"?A.names=C.TITLE:A.names=C.UPPER;else if("YMDdFWwXxHhmsf".indexOf(A.component)!==-1){var ae=A.presentation1;if(A.presentation2&&(ae+=";"+A.presentation2),A.integerFormat=ue(ae),A.width&&A.width.min!==void 0&&A.integerFormat.mandatoryDigits<A.width.min&&(A.integerFormat.mandatoryDigits=A.width.min),"YMD".indexOf(A.component)!==-1)if(A.n=-1,A.width&&A.width.max!==void 0)A.n=A.width.max,A.integerFormat.mandatoryDigits=A.n;else{var H=A.integerFormat.mandatoryDigits+A.integerFormat.optionalDigits;H>=2&&(A.n=H)}}(A.component==="Z"||A.component==="z")&&(A.integerFormat=ue(A.presentation1)),b.push(A),O=D+1}D++}return P(O,D),y}const ie=["","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],ke=["January","February","March","April","May","June","July","August","September","October","November","December"],Le=1e3*60*60*24,fe=function(v){const b=Date.UTC(v.year,v.month);var y=new Date(b).getUTCDay();return y===0&&(y=7),y>4?b+(8-y)*Le:b-(y-1)*Le},K=function(v,b){return{year:v,month:b,nextMonth:function(){return b===11?K(v+1,0):K(v,b+1)},previousMonth:function(){return b===0?K(v-1,11):K(v,b-1)},nextYear:function(){return K(v+1,b)},previousYear:function(){return K(v-1,b)}}},ze=function(v,b){return(b-v)/(Le*7)+1},J=(v,b)=>{let y;switch(b){case"Y":y=v.getUTCFullYear();break;case"M":y=v.getUTCMonth()+1;break;case"D":y=v.getUTCDate();break;case"d":{const P=Date.UTC(v.getUTCFullYear(),v.getUTCMonth(),v.getUTCDate()),O=Date.UTC(v.getUTCFullYear(),0);y=(P-O)/Le+1;break}case"F":y=v.getUTCDay(),y===0&&(y=7);break;case"W":{const P=K(v.getUTCFullYear(),0),O=fe(P),D=Date.UTC(P.year,v.getUTCMonth(),v.getUTCDate());let A=ze(O,D);if(A>52){const x=fe(P.nextYear());D>=x&&(A=1)}else if(A<1){const x=fe(P.previousYear());A=ze(x,D)}y=Math.floor(A);break}case"w":{const P=K(v.getUTCFullYear(),v.getUTCMonth()),O=fe(P),D=Date.UTC(P.year,P.month,v.getUTCDate());let A=ze(O,D);if(A>4){const x=fe(P.nextMonth());D>=x&&(A=1)}else if(A<1){const x=fe(P.previousMonth());A=ze(x,D)}y=Math.floor(A);break}case"X":{const P=K(v.getUTCFullYear(),0),O=fe(P),D=fe(P.nextYear()),A=v.getTime();A<O?y=P.year-1:A>=D?y=P.year+1:y=P.year;break}case"x":{const P=K(v.getUTCFullYear(),v.getUTCMonth()),O=fe(P),D=P.nextMonth(),A=fe(D),x=v.getTime();x<O?y=P.previousMonth().month+1:x>=A?y=D.month+1:y=P.month+1;break}case"H":y=v.getUTCHours();break;case"h":y=v.getUTCHours(),y=y%12,y===0&&(y=12);break;case"P":y=v.getUTCHours()>=12?"pm":"am";break;case"m":y=v.getUTCMinutes();break;case"s":y=v.getUTCSeconds();break;case"f":y=v.getUTCMilliseconds();break;case"Z":case"z":break;case"C":y="ISO";break;case"E":y="ISO";break}return y};let $e=null;function We(v,b,y){var P=0,O=0;if(typeof y<"u"){const ae=parseInt(y);P=Math.floor(ae/100),O=ae%100}var D=function(ae,H){var Y=J(ae,H.component);if("YMDdFWwXxHhms".indexOf(H.component)!==-1)if(H.component==="Y"&&H.n!==-1&&(Y=Y%Math.pow(10,H.n)),H.names){if(H.component==="M"||H.component==="x")Y=ke[Y-1];else if(H.component==="F")Y=ie[Y];else throw{code:"D3133",value:H.component};H.names===C.UPPER?Y=Y.toUpperCase():H.names===C.LOWER&&(Y=Y.toLowerCase()),H.width&&Y.length>H.width.max&&(Y=Y.substring(0,H.width.max))}else Y=L(Y,H.integerFormat);else if(H.component==="f")Y=L(Y,H.integerFormat);else if(H.component==="Z"||H.component==="z"){const le=P*100+O;if(H.integerFormat.regular)Y=L(le,H.integerFormat);else{const z=H.integerFormat.mandatoryDigits;if(z===1||z===2)Y=L(P,H.integerFormat),O!==0&&(Y+=":"+j(O,"00"));else if(z===3||z===4)Y=L(le,H.integerFormat);else throw{code:"D3134",value:z}}le>=0&&(Y="+"+Y),H.component==="z"&&(Y="GMT"+Y),le===0&&H.presentation2==="t"&&(Y="Z")}else H.component==="P"&&H.names===C.UPPER&&(Y=Y.toUpperCase());return Y};let A;typeof b>"u"?($e===null&&($e=he("[Y0001]-[M01]-[D01]T[H01]:[m01]:[s01].[f001][Z01:01t]")),A=$e):A=he(b);const x=(60*P+O)*60*1e3,q=new Date(v+x);let re="";return A.parts.forEach(function(ae){ae.type==="literal"?re+=ae.value:re+=D(q,ae)}),re}function s(v){var b={};if(v.type==="datetime")b.type="datetime",b.parts=v.parts.map(function(y){var P={};if(y.type==="literal")P.regex=y.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");else if(y.component==="Z"||y.component==="z"){let D;Array.isArray(y.integerFormat.groupingSeparators)||(D=y.integerFormat.groupingSeparators),P.regex="",y.component==="z"&&(P.regex="GMT"),P.regex+="[-+][0-9]+",D&&(P.regex+=D.character+"[0-9]+"),P.parse=function(A){y.component==="z"&&(A=A.substring(3));let x=0,q=0;return D?(x=Number.parseInt(A.substring(0,A.indexOf(D.character))),q=Number.parseInt(A.substring(A.indexOf(D.character)+1))):A.length-1<=2?x=Number.parseInt(A):(x=Number.parseInt(A.substring(0,3)),q=Number.parseInt(A.substring(3))),x*60+q}}else if(y.integerFormat)y.integerFormat.n=y.n,P=s(y.integerFormat);else{P.regex="[a-zA-Z]+";var O={};if(y.component==="M"||y.component==="x")ke.forEach(function(D,A){y.width&&y.width.max?O[D.substring(0,y.width.max)]=A+1:O[D]=A+1});else if(y.component==="F")ie.forEach(function(D,A){A>0&&(y.width&&y.width.max?O[D.substring(0,y.width.max)]=A:O[D]=A)});else if(y.component==="P")O={am:0,AM:0,pm:1,PM:1};else throw{code:"D3133",value:y.component};P.parse=function(D){return O[D]}}return P.component=y.component,P});else{b.type="integer";const y=v.case===C.UPPER;let P;switch(v.n&&v.n>0?v.optionalDigits===0?P=`{${v.n}}`:P=`{${v.n-v.optionalDigits},${v.n}}`:P="+",v.primary){case m.LETTERS:b.regex=y?"[A-Z]+":"[a-z]+",b.parse=function(O){return Z(O,y?"A":"a")};break;case m.ROMAN:b.regex=y?"[MDCLXVI]+":"[mdclxvi]+",b.parse=function(O){return B(y?O:O.toUpperCase())};break;case m.WORDS:b.regex="(?:"+Object.keys(E).concat("and","[\\-, ]").join("|")+")+",b.parse=function(O){return F(O.toLowerCase())};break;case m.DECIMAL:b.regex=`[0-9]${P}`,v.ordinal&&(b.regex+="(?:th|st|nd|rd)"),b.parse=function(O){let D=O;return v.ordinal&&(D=O.substring(0,O.length-2)),v.regular?D=D.split(",").join(""):v.groupingSeparators.forEach(A=>{D=D.split(A.character).join("")}),v.zeroCode!==48&&(D=D.split("").map(A=>String.fromCodePoint(A.codePointAt(0)-v.zeroCode+48)).join("")),parseInt(D)};break;case m.SEQUENCE:throw{code:"D3130",value:v.token}}}return b}function c(v,b){if(typeof v>"u")return;const y=ue(b);return s(y).parse(v)}function R(v,b){const y=he(b),P=s(y),O="^"+P.parts.map(q=>"("+q.regex+")").join("")+"$";var A=new RegExp(O,"i").exec(v);if(A!==null){const z={};for(let ve=1;ve<A.length;ve++){const r=P.parts[ve-1];r.parse&&(z[r.component]=r.parse(A[ve]))}if(Object.getOwnPropertyNames(z).length===0)return;let De=0;const Be=ve=>{De<<=1,De+=ve?1:0},Ue=ve=>!(~ve&De)&&!!(ve&De);"YXMxWwdD".split("").forEach(ve=>Be(z[ve]));const Ne=!Ue(161)&&Ue(130),Ze=Ue(84),Qe=!Ze&&Ue(72);De=0,"PHhmsf".split("").forEach(ve=>Be(z[ve]));const Ke=!Ue(23)&&Ue(47),yt=(Ne?"YD":Ze?"XxwF":Qe?"XWF":"YMD")+(Ke?"Phmsf":"Hmsf"),Ve=this.environment.timestamp;let ut=!1,Je=!1;if(yt.split("").forEach(ve=>{if(typeof z[ve]>"u")ut?(z[ve]="MDd".indexOf(ve)!==-1?1:0,Je=!0):z[ve]=J(Ve,ve);else if(ut=!0,Je)throw{code:"D3136"}}),z.M>0?z.M-=1:z.M=0,Ne){const ve=Date.UTC(z.Y,0),r=(z.d-1)*1e3*60*60*24,o=new Date(ve+r);z.M=o.getUTCMonth(),z.D=o.getUTCDate()}if(Ze)throw{code:"D3136"};if(Qe)throw{code:"D3136"};Ke&&(z.H=z.h===12?0:z.h,z.P===1&&(z.H+=12));var x=Date.UTC(z.Y,z.M,z.D,z.H,z.m,z.s,z.f);return(z.Z||z.z)&&(x-=(z.Z||z.z)*60*1e3),x}}var ee=new RegExp("^\\d{4}(-[01]\\d)*(-[0-3]\\d)*(T[0-2]\\d:[0-5]\\d:[0-5]\\d)*(\\.\\d+)?([+-][0-2]\\d:?[0-5]\\d|Z)?$");function ge(v,b){if(!(typeof v>"u"))if(typeof b>"u"){if(!ee.test(v))throw{stack:new Error().stack,code:"D3110",value:v};return Date.parse(v)}else return R.call(this,v,b)}function ce(v,b,y){if(!(typeof v>"u"))return We.call(this,v,b,y)}return{formatInteger:j,parseInteger:c,fromMillis:ce,toMillis:ge}}();d.exports=h},{"./utils":6}],2:[function(a,d,p){(function(w){(function(){var h=a("./utils");const U=(()=>{var N=h.isNumeric,G=h.isArrayOfStrings,X=h.isArrayOfNumbers,$=h.createSequence,k=h.isSequence,E=h.isFunction,F=h.isLambda,oe=h.isPromise,we=h.getFunctionArity,me=h.isDeepEqual,B=h.stringToArray;function S(e){if(!(typeof e>"u")){var t=0;return e.forEach(function(i){t+=i}),t}}function Z(e){return typeof e>"u"?0:e.length}function j(e){if(!(typeof e>"u"||e.length===0))return Math.max.apply(Math,e)}function m(e){if(!(typeof e>"u"||e.length===0))return Math.min.apply(Math,e)}function C(e){if(!(typeof e>"u"||e.length===0)){var t=0;return e.forEach(function(i){t+=i}),t/e.length}}function L(e,t=!1){if(!(typeof e>"u")){var i;if(typeof e=="string")i=e;else if(E(e))i="";else{if(typeof e=="number"&&!isFinite(e))throw{code:"D3001",value:e,stack:new Error().stack};var l=t?2:0;Array.isArray(e)&&e.outerWrapper&&(e=e[0]),i=JSON.stringify(e,function(u,g){return typeof g<"u"&&g!==null&&g.toPrecision&&N(g)?Number(g.toPrecision(15)):g&&E(g)?"":g},l)}return i}}function te(e,t,i){if(!(typeof e>"u")){var l=B(e),u=l.length;if(u+t<0&&(t=0),typeof i<"u"){if(i<=0)return"";var g=t>=0?t+i:u+t+i;return l.slice(t,g).join("")}return l.slice(t).join("")}}function ue(e,t){if(!(typeof e>"u")){var i=e.indexOf(t);return i>-1?e.substr(0,i):e}}function de(e,t){if(!(typeof e>"u")){var i=e.indexOf(t);return i>-1?e.substr(i+t.length):e}}function he(e){if(!(typeof e>"u"))return e.toLowerCase()}function ie(e){if(!(typeof e>"u"))return e.toUpperCase()}function ke(e){if(!(typeof e>"u"))return B(e).length}function Le(e){if(!(typeof e>"u")){var t=e.replace(/[ \t\n\r]+/gm," ");return t.charAt(0)===" "&&(t=t.substring(1)),t.charAt(t.length-1)===" "&&(t=t.substring(0,t.length-1)),t}}function fe(e,t,i){if(!(typeof e>"u")){(typeof i>"u"||i.length===0)&&(i=" ");var l,u=Math.abs(t)-ke(e);if(u>0){var g=new Array(u+1).join(i);i.length>1&&(g=te(g,0,u)),t>0?l=e+g:l=g+e}else l=e;return l}}async function K(e,t){var i=e.apply(this,[t]);if(oe(i)&&(i=await i),i&&!(typeof i.start=="number"||i.end==="number"||Array.isArray(i.groups)||E(i.next)))throw{code:"T1010",stack:new Error().stack};return i}async function ze(e,t){if(!(typeof e>"u")){var i;if(typeof t=="string")i=e.indexOf(t)!==-1;else{var l=await K(t,e);i=typeof l<"u"}return i}}async function J(e,t,i){if(!(typeof e>"u")){if(i<0)throw{stack:new Error().stack,value:i,code:"D3040",index:3};var l=$();if(typeof i>"u"||i>0){var u=0,g=await K(t,e);if(typeof g<"u")for(;typeof g<"u"&&(typeof i>"u"||u<i);)l.push({match:g.match,index:g.start,groups:g.groups}),g=await K(g.next),u++}return l}}async function $e(e,t,i,l){if(!(typeof e>"u")){var u=this;if(t==="")throw{code:"D3010",stack:new Error().stack,value:t,index:2};if(l<0)throw{code:"D3011",stack:new Error().stack,value:l,index:4};var g;typeof i=="string"?g=function(pe){for(var Oe="",se=0,_e=i.indexOf("$",se);_e!==-1&&se<i.length;){Oe+=i.substring(se,_e),se=_e+1;var Ye=i.charAt(se);if(Ye==="$")Oe+="$",se++;else if(Ye==="0")Oe+=pe.match,se++;else{var Ce;if(pe.groups.length===0?Ce=1:Ce=Math.floor(Math.log(pe.groups.length)*Math.LOG10E)+1,_e=parseInt(i.substring(se,se+Ce),10),Ce>1&&_e>pe.groups.length&&(_e=parseInt(i.substring(se,se+Ce-1),10)),isNaN(_e))Oe+="$";else{if(pe.groups.length>0){var ft=pe.groups[_e-1];typeof ft<"u"&&(Oe+=ft)}se+=_e.toString().length}}_e=i.indexOf("$",se)}return Oe+=i.substring(se),Oe}:g=i;var T="",I=0;if(typeof l>"u"||l>0){var W=0;if(typeof t=="string"){for(var ye=e.indexOf(t,I);ye!==-1&&(typeof l>"u"||W<l);)T+=e.substring(I,ye),T+=i,I=ye+t.length,W++,ye=e.indexOf(t,I);T+=e.substring(I)}else{var ne=await K(t,e);if(typeof ne<"u"){for(;typeof ne<"u"&&(typeof l>"u"||W<l);){T+=e.substring(I,ne.start);var be=g.apply(u,[ne]);if(oe(be)&&(be=await be),typeof be=="string")T+=be;else throw{code:"D3012",stack:new Error().stack,value:be};I=ne.start+ne.match.length,W++,ne=await K(ne.next)}T+=e.substring(I)}else T=e}}else T=e;return T}}function We(e){if(!(typeof e>"u")){var t=typeof window<"u"?window.btoa:function(i){return new w.Buffer.from(i,"binary").toString("base64")};return t(e)}}function s(e){if(!(typeof e>"u")){var t=typeof window<"u"?window.atob:function(i){return new w.Buffer.from(i,"base64").toString("binary")};return t(e)}}function c(e){if(!(typeof e>"u")){var t;try{t=encodeURIComponent(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"encodeUrlComponent"}}return t}}function R(e){if(!(typeof e>"u")){var t;try{t=encodeURI(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"encodeUrl"}}return t}}function ee(e){if(!(typeof e>"u")){var t;try{t=decodeURIComponent(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"decodeUrlComponent"}}return t}}function ge(e){if(!(typeof e>"u")){var t;try{t=decodeURI(e)}catch{throw{code:"D3140",stack:new Error().stack,value:e,functionName:"decodeUrl"}}return t}}async function ce(e,t,i){if(!(typeof e>"u")){if(i<0)throw{code:"D3020",stack:new Error().stack,value:i,index:3};var l=[];if(typeof i>"u"||i>0)if(typeof t=="string")l=e.split(t,i);else{var u=0,g=await K(t,e);if(typeof g<"u"){for(var T=0;typeof g<"u"&&(typeof i>"u"||u<i);)l.push(e.substring(T,g.start)),T=g.end,g=await K(g.next),u++;(typeof i>"u"||u<i)&&l.push(e.substring(T))}else l.push(e)}return l}}function v(e,t){if(!(typeof e>"u"))return typeof t>"u"&&(t=""),e.join(t)}function b(e,t,i){if(!(typeof e>"u")){var l={"decimal-separator":".","grouping-separator":",","exponent-separator":"e",infinity:"Infinity","minus-sign":"-",NaN:"NaN",percent:"%","per-mille":"‰","zero-digit":"0",digit:"#","pattern-separator":";"},u=l;typeof i<"u"&&Object.keys(i).forEach(function(V){u[V]=i[V]});for(var g=[],T=u["zero-digit"].charCodeAt(0),I=T;I<T+10;I++)g.push(String.fromCharCode(I));var W=g.concat([u["decimal-separator"],u["exponent-separator"],u["grouping-separator"],u.digit,u["pattern-separator"]]),ye=t.split(u["pattern-separator"]);if(ye.length>2)throw{code:"D3080",stack:new Error().stack};var ne=function(V){var Ee=function(){for(var Te,qe=0;qe<V.length;qe++)if(Te=V.charAt(qe),W.indexOf(Te)!==-1&&Te!==u["exponent-separator"])return V.substring(0,qe)}(),je=function(){for(var Te,qe=V.length-1;qe>=0;qe--)if(Te=V.charAt(qe),W.indexOf(Te)!==-1&&Te!==u["exponent-separator"])return V.substring(qe+1)}(),Ae=V.substring(Ee.length,V.length-je.length),Re,et,Ie,it,He=V.indexOf(u["exponent-separator"],Ee.length);He===-1||He>V.length-je.length?(Re=Ae,et=void 0):(Re=Ae.substring(0,He),et=Ae.substring(He+1));var Ge=Re.indexOf(u["decimal-separator"]);return Ge===-1?(Ie=Re,it=je):(Ie=Re.substring(0,Ge),it=Re.substring(Ge+1)),{prefix:Ee,suffix:je,activePart:Ae,mantissaPart:Re,exponentPart:et,integerPart:Ie,fractionalPart:it,subpicture:V}},be=function(V){var Ee,je,Ae=V.subpicture,Re=Ae.indexOf(u["decimal-separator"]);Re!==Ae.lastIndexOf(u["decimal-separator"])&&(Ee="D3081"),Ae.indexOf(u.percent)!==Ae.lastIndexOf(u.percent)&&(Ee="D3082"),Ae.indexOf(u["per-mille"])!==Ae.lastIndexOf(u["per-mille"])&&(Ee="D3083"),Ae.indexOf(u.percent)!==-1&&Ae.indexOf(u["per-mille"])!==-1&&(Ee="D3084");var et=!1;for(je=0;je<V.mantissaPart.length;je++){var Ie=V.mantissaPart.charAt(je);if(g.indexOf(Ie)!==-1||Ie===u.digit){et=!0;break}}et||(Ee="D3085");var it=V.activePart.split("").map(function(Te){return W.indexOf(Te)===-1?"p":"a"}).join("");it.indexOf("p")!==-1&&(Ee="D3086"),Re!==-1?(Ae.charAt(Re-1)===u["grouping-separator"]||Ae.charAt(Re+1)===u["grouping-separator"])&&(Ee="D3087"):V.integerPart.charAt(V.integerPart.length-1)===u["grouping-separator"]&&(Ee="D3088"),Ae.indexOf(u["grouping-separator"]+u["grouping-separator"])!==-1&&(Ee="D3089");var He=V.integerPart.indexOf(u.digit);He!==-1&&V.integerPart.substring(0,He).split("").filter(function(Te){return g.indexOf(Te)>-1}).length>0&&(Ee="D3090"),He=V.fractionalPart.lastIndexOf(u.digit),He!==-1&&V.fractionalPart.substring(He).split("").filter(function(Te){return g.indexOf(Te)>-1}).length>0&&(Ee="D3091");var Ge=typeof V.exponentPart=="string";if(Ge&&V.exponentPart.length>0&&(Ae.indexOf(u.percent)!==-1||Ae.indexOf(u["per-mille"])!==-1)&&(Ee="D3092"),Ge&&(V.exponentPart.length===0||V.exponentPart.split("").filter(function(Te){return g.indexOf(Te)===-1}).length>0)&&(Ee="D3093"),Ee)throw{code:Ee,stack:new Error().stack}},pe=function(V){var Ee=function(Me,xt){for(var bt=[],Xe=Me.indexOf(u["grouping-separator"]);Xe!==-1;){var Ct=(xt?Me.substring(0,Xe):Me.substring(Xe)).split("").filter(function(lt){return g.indexOf(lt)!==-1||lt===u.digit}).length;bt.push(Ct),Xe=V.integerPart.indexOf(u["grouping-separator"],Xe+1)}return bt},je=Ee(V.integerPart),Ae=function(Me){if(Me.length===0)return 0;for(var xt=function(Ct,lt){return lt===0?Ct:xt(lt,Ct%lt)},bt=Me.reduce(xt),Xe=1;Xe<=Me.length;Xe++)if(Me.indexOf(Xe*bt)===-1)return 0;return bt},Re=Ae(je),et=Ee(V.fractionalPart,!0),Ie=V.integerPart.split("").filter(function(Me){return g.indexOf(Me)!==-1}).length,it=Ie,He=V.fractionalPart.split(""),Ge=He.filter(function(Me){return g.indexOf(Me)!==-1}).length,Te=He.filter(function(Me){return g.indexOf(Me)!==-1||Me===u.digit}).length,qe=typeof V.exponentPart=="string";Ie===0&&Te===0&&(qe?(Ge=1,Te=1):Ie=1),qe&&Ie===0&&V.integerPart.indexOf(u.digit)!==-1&&(Ie=1),Ie===0&&Ge===0&&(Ge=1);var Gt=0;return qe&&(Gt=V.exponentPart.split("").filter(function(Me){return g.indexOf(Me)!==-1}).length),{integerPartGroupingPositions:je,regularGrouping:Re,minimumIntegerPartSize:Ie,scalingFactor:it,prefix:V.prefix,fractionalPartGroupingPositions:et,minimumFactionalPartSize:Ge,maximumFactionalPartSize:Te,minimumExponentSize:Gt,suffix:V.suffix,picture:V.subpicture}},Oe=ye.map(ne);Oe.forEach(be);var se=Oe.map(pe),_e=u["minus-sign"],Ye=u["zero-digit"],Ce=u["decimal-separator"],ft=u["grouping-separator"];se.length===1&&(se.push(JSON.parse(JSON.stringify(se[0]))),se[1].prefix=_e+se[1].prefix);var Se;e>=0?Se=se[0]:Se=se[1];var gt;Se.picture.indexOf(u.percent)!==-1?gt=e*100:Se.picture.indexOf(u["per-mille"])!==-1?gt=e*1e3:gt=e;var rt,ct;if(Se.minimumExponentSize===0)rt=gt;else{var yn=Math.pow(10,Se.scalingFactor),gn=Math.pow(10,Se.scalingFactor-1);for(rt=gt,ct=0;rt<gn;)rt*=10,ct-=1;for(;rt>yn;)rt/=10,ct+=1}var mn=x(rt,Se.maximumFactionalPartSize),Yt=function(V,Ee){var je=Math.abs(V).toFixed(Ee);return Ye!=="0"&&(je=je.split("").map(function(Ae){return Ae>="0"&&Ae<="9"?g[Ae.charCodeAt(0)-48]:Ae}).join("")),je},Q=Yt(mn,Se.maximumFactionalPartSize),Fe=Q.indexOf(".");for(Fe===-1?Q=Q+Ce:Q=Q.replace(".",Ce);Q.charAt(0)===Ye;)Q=Q.substring(1);for(;Q.charAt(Q.length-1)===Ye;)Q=Q.substring(0,Q.length-1);Fe=Q.indexOf(Ce);var mt=Se.minimumIntegerPartSize-Fe,Vt=Se.minimumFactionalPartSize-(Q.length-Fe-1);if(Q=(mt>0?new Array(mt+1).join(Ye):"")+Q,Q=Q+(Vt>0?new Array(Vt+1).join(Ye):""),Fe=Q.indexOf(Ce),Se.regularGrouping>0)for(var bn=Math.floor((Fe-1)/Se.regularGrouping),Dt=1;Dt<=bn;Dt++)Q=[Q.slice(0,Fe-Dt*Se.regularGrouping),ft,Q.slice(Fe-Dt*Se.regularGrouping)].join("");else Se.integerPartGroupingPositions.forEach(function(V){Q=[Q.slice(0,Fe-V),ft,Q.slice(Fe-V)].join(""),Fe++});if(Fe=Q.indexOf(Ce),Se.fractionalPartGroupingPositions.forEach(function(V){Q=[Q.slice(0,V+Fe+1),ft,Q.slice(V+Fe+1)].join("")}),Fe=Q.indexOf(Ce),(Se.picture.indexOf(Ce)===-1||Fe===Q.length-1)&&(Q=Q.substring(0,Q.length-1)),typeof ct<"u"){var Ot=Yt(ct,0);mt=Se.minimumExponentSize-Ot.length,mt>0&&(Ot=new Array(mt+1).join(Ye)+Ot),Q=Q+u["exponent-separator"]+(ct<0?_e:"")+Ot}return Q=Se.prefix+Q+Se.suffix,Q}}function y(e,t){if(!(typeof e>"u")){if(e=x(e),typeof t>"u"?t=10:t=x(t),t<2||t>36)throw{code:"D3100",stack:new Error().stack,value:t};var i=e.toString(t);return i}}function P(e){var t;if(!(typeof e>"u")){if(typeof e=="number")t=e;else if(typeof e=="string"&&/^-?[0-9]+(\.[0-9]+)?([Ee][-+]?[0-9]+)?$/.test(e)&&!isNaN(parseFloat(e))&&isFinite(e))t=parseFloat(e);else if(typeof e=="string"&&/^(0[xX][0-9A-Fa-f]+)|(0[oO][0-7]+)|(0[bB][0-1]+)$/.test(e))t=Number(e);else if(e===!0)t=1;else if(e===!1)t=0;else throw{code:"D3030",value:e,stack:new Error().stack,index:1};return t}}function O(e){var t;if(!(typeof e>"u"))return t=Math.abs(e),t}function D(e){var t;if(!(typeof e>"u"))return t=Math.floor(e),t}function A(e){var t;if(!(typeof e>"u"))return t=Math.ceil(e),t}function x(e,t){var i;if(!(typeof e>"u")){if(t){var l=e.toString().split("e");e=+(l[0]+"e"+(l[1]?+l[1]+t:t))}i=Math.round(e);var u=i-e;return Math.abs(u)===.5&&Math.abs(i%2)===1&&(i=i-1),t&&(l=i.toString().split("e"),i=+(l[0]+"e"+(l[1]?+l[1]-t:-t))),Object.is(i,-0)&&(i=0),i}}function q(e){var t;if(!(typeof e>"u")){if(e<0)throw{stack:new Error().stack,code:"D3060",index:1,value:e};return t=Math.sqrt(e),t}}function re(e,t){var i;if(!(typeof e>"u")){if(i=Math.pow(e,t),!isFinite(i))throw{stack:new Error().stack,code:"D3061",index:1,value:e,exp:t};return i}}function ae(){return Math.random()}function H(e){if(!(typeof e>"u")){var t=!1;if(Array.isArray(e)){if(e.length===1)t=H(e[0]);else if(e.length>1){var i=e.filter(function(l){return H(l)});t=i.length>0}}else typeof e=="string"?e.length>0&&(t=!0):N(e)?e!==0&&(t=!0):e!==null&&typeof e=="object"?Object.keys(e).length>0&&(t=!0):typeof e=="boolean"&&e===!0&&(t=!0);return t}}function Y(e){if(!(typeof e>"u"))return!H(e)}function le(e,t,i,l){var u=[t],g=we(e);return g>=2&&u.push(i),g>=3&&u.push(l),u}async function z(e,t){if(!(typeof e>"u")){for(var i=$(),l=0;l<e.length;l++){var u=le(t,e[l],l,e),g=await t.apply(this,u);typeof g<"u"&&i.push(g)}return i}}async function De(e,t){if(!(typeof e>"u")){for(var i=$(),l=0;l<e.length;l++){var u=e[l],g=le(t,u,l,e),T=await t.apply(this,g);H(T)&&i.push(u)}return i}}async function Be(e,t){if(!(typeof e>"u")){for(var i=!1,l,u=0;u<e.length;u++){var g=e[u],T=!0;if(typeof t<"u"){var I=le(t,g,u,e),W=await t.apply(this,I);T=H(W)}if(T)if(!i)l=g,i=!0;else throw{stack:new Error().stack,code:"D3138",index:u}}if(!i)throw{stack:new Error().stack,code:"D3139"};return l}}function Ue(){for(var e=[],t=Array.prototype.slice.call(arguments),i=Math.min.apply(Math,t.map(function(g){return Array.isArray(g)?g.length:0})),l=0;l<i;l++){var u=t.map(g=>g[l]);e.push(u)}return e}async function Pe(e,t,i){if(!(typeof e>"u")){var l,u=we(t);if(u<2)throw{stack:new Error().stack,code:"D3050",index:1};var g;for(typeof i>"u"&&e.length>0?(l=e[0],g=1):(l=i,g=0);g<e.length;){var T=[l,e[g]];u>=3&&T.push(g),u>=4&&T.push(e),l=await t.apply(this,T),g++}return l}}function Ne(e){var t=$();if(Array.isArray(e)){var i={};e.forEach(function(l){var u=Ne(l);u.forEach(function(g){i[g]=!0})}),t=Ne(i)}else e!==null&&typeof e=="object"&&!F(e)&&Object.keys(e).forEach(l=>t.push(l));return t}function Ze(e,t){var i;if(Array.isArray(e)){i=$();for(var l=0;l<e.length;l++){var u=Ze(e[l],t);typeof u<"u"&&(Array.isArray(u)?u.forEach(g=>i.push(g)):i.push(u))}}else e!==null&&typeof e=="object"&&(i=e[t]);return i}function Qe(e,t){return typeof e>"u"?t:typeof t>"u"?e:(Array.isArray(e)||(e=$(e)),Array.isArray(t)||(t=[t]),e.concat(t))}function Pt(e){return!(typeof e>"u")}function Ke(e){var t=$();if(Array.isArray(e))e.forEach(function(u){t=Qe(t,Ke(u))});else if(e!==null&&typeof e=="object"&&!F(e))for(var i in e){var l={};l[i]=e[i],t.push(l)}else t=e;return t}function M(e){if(!(typeof e>"u")){var t={};return e.forEach(function(i){for(var l in i)t[l]=i[l]}),t}}function Tt(e){if(!(typeof e>"u")){if(e.length<=1)return e;for(var t=e.length,i=new Array(t),l=0;l<t;l++)i[t-l-1]=e[l];return i}}async function yt(e,t){var i=$();for(var l in e){var u=le(t,e[l],l,e),g=await t.apply(this,u);typeof g<"u"&&i.push(g)}return i}function Ve(e){throw{code:"D3137",stack:new Error().stack,message:e||"$error() function evaluated"}}function ut(e,t){if(!e)throw{code:"D3141",stack:new Error().stack,message:t||"$assert() statement failed"}}function Je(e){if(e!==void 0)return e===null?"null":N(e)?"number":typeof e=="string"?"string":typeof e=="boolean"?"boolean":Array.isArray(e)?"array":E(e)?"function":"object"}async function ve(e,t){if(!(typeof e>"u")){if(e.length<=1)return e;var i;if(typeof t>"u"){if(!X(e)&&!G(e))throw{stack:new Error().stack,code:"D3070",index:1};i=async function(T,I){return T>I}}else i=t;var l=async function(T,I){var W=async function(ne,be,pe){be.length===0?Array.prototype.push.apply(ne,pe):pe.length===0?Array.prototype.push.apply(ne,be):await i(be[0],pe[0])?(ne.push(pe[0]),await W(ne,be,pe.slice(1))):(ne.push(be[0]),await W(ne,be.slice(1),pe))},ye=[];return await W(ye,T,I),ye},u=async function(T){if(!Array.isArray(T)||T.length<=1)return T;var I=Math.floor(T.length/2),W=T.slice(0,I),ye=T.slice(I);return W=await u(W),ye=await u(ye),await l(W,ye)},g=await u(e);return g}}function r(e){if(!(typeof e>"u")){if(e.length<=1)return e;for(var t=new Array(e.length),i=0;i<e.length;i++){var l=Math.floor(Math.random()*(i+1));i!==l&&(t[i]=t[l]),t[l]=e[i]}return t}}function o(e){if(!(typeof e>"u")){if(!Array.isArray(e)||e.length<=1)return e;for(var t=k(e)?$():[],i=0;i<e.length;i++){for(var l=e[i],u=!1,g=0;g<t.length;g++)if(me(l,t[g])){u=!0;break}u||t.push(l)}return t}}async function f(e,t){var i={};for(var l in e){var u=e[l],g=le(t,u,l,e),T=await t.apply(this,g);H(T)&&(i[l]=u)}return Object.keys(i).length===0&&(i=void 0),i}return{sum:S,count:Z,max:j,min:m,average:C,string:L,substring:te,substringBefore:ue,substringAfter:de,lowercase:he,uppercase:ie,length:ke,trim:Le,pad:fe,match:J,contains:ze,replace:$e,split:ce,join:v,formatNumber:b,formatBase:y,number:P,floor:D,ceil:A,round:x,abs:O,sqrt:q,power:re,random:ae,boolean:H,not:Y,map:z,zip:Ue,filter:De,single:Be,foldLeft:Pe,sift:f,keys:Ne,lookup:Ze,append:Qe,exists:Pt,spread:Ke,merge:M,reverse:Tt,each:yt,error:Ve,assert:ut,type:Je,sort:ve,shuffle:r,distinct:o,base64encode:We,base64decode:s,encodeUrlComponent:c,encodeUrl:R,decodeUrlComponent:ee,decodeUrl:ge}})();d.exports=U}).call(this)}).call(this,typeof sn<"u"?sn:typeof self<"u"?self:typeof window<"u"?window:{})},{"./utils":6}],3:[function(a,d,p){var w=a("./datetime"),h=a("./functions"),U=a("./utils"),N=a("./parser"),G=a("./signature"),X=function(){var $=U.isNumeric,k=U.isArrayOfStrings,E=U.isArrayOfNumbers,F=U.createSequence,oe=U.isSequence,we=U.isFunction,me=U.isLambda,B=U.isIterable,S=U.isPromise,Z=U.getFunctionArity,j=U.isDeepEqual,m=Ve(null);async function C(r,o,f){var e,t=f.lookup("__evaluate_entry");switch(t&&await t(r,o,f),r.type){case"path":e=await L(r,o,f);break;case"binary":e=await ke(r,o,f);break;case"unary":e=await Le(r,o,f);break;case"name":e=fe(r,o);break;case"string":case"number":case"value":e=K(r);break;case"wildcard":e=ze(r,o);break;case"descendant":e=$e(r,o);break;case"parent":e=f.lookup(r.slot.label);break;case"condition":e=await D(r,o,f);break;case"block":e=await A(r,o,f);break;case"bind":e=await O(r,o,f);break;case"regex":e=x(r);break;case"function":e=await le(r,o,f);break;case"variable":e=q(r,o,f);break;case"lambda":e=Be(r,o,f);break;case"partial":e=await Ue(r,o,f);break;case"apply":e=await Y(r,o,f);break;case"transform":e=ae(r,o,f);break}if(Object.prototype.hasOwnProperty.call(r,"predicate"))for(var i=0;i<r.predicate.length;i++)e=await ie(r.predicate[i].expr,e,f);r.type!=="path"&&Object.prototype.hasOwnProperty.call(r,"group")&&(e=await b(r.group,e,f));var l=f.lookup("__evaluate_exit");return l&&await l(r,o,f,e),e&&oe(e)&&!e.tupleStream&&(r.keepArray&&(e.keepSingleton=!0),e.length===0?e=void 0:e.length===1&&(e=e.keepSingleton?e:e[0])),e}async function L(r,o,f){var e;Array.isArray(o)&&r.steps[0].type!=="variable"?e=o:e=F(o);for(var t,i=!1,l=void 0,u=0;u<r.steps.length;u++){var g=r.steps[u];if(g.tuple&&(i=!0),u===0&&g.consarray?t=await C(g,e,f):i?l=await he(g,e,l,f):t=await ue(g,e,f,u===r.steps.length-1),!i&&(typeof t>"u"||t.length===0))break;typeof g.focus>"u"&&(e=t)}if(i)if(r.tuple)t=l;else for(t=F(),u=0;u<l.length;u++)t.push(l[u]["@"]);return r.keepSingletonArray&&(Array.isArray(t)&&t.cons&&!t.sequence&&(t=F(t)),t.keepSingleton=!0),r.hasOwnProperty("group")&&(t=await b(r.group,i?l:t,f)),t}function te(r,o){var f=Ve(r);for(const e in o)f.bind(e,o[e]);return f}async function ue(r,o,f,e){var t;if(r.type==="sort")return t=await re(r,o,f),r.stages&&(t=await de(r.stages,t,f)),t;t=F();for(var i=0;i<o.length;i++){var l=await C(r,o[i],f);if(r.stages)for(var u=0;u<r.stages.length;u++)l=await ie(r.stages[u].expr,l,f);typeof l<"u"&&t.push(l)}var g=F();return e&&t.length===1&&Array.isArray(t[0])&&!oe(t[0])?g=t[0]:t.forEach(function(T){!Array.isArray(T)||T.cons?g.push(T):T.forEach(I=>g.push(I))}),g}async function de(r,o,f){for(var e=o,t=0;t<r.length;t++){var i=r[t];switch(i.type){case"filter":e=await ie(i.expr,e,f);break;case"index":for(var l=0;l<e.length;l++){var u=e[l];u[i.value]=l}break}}return e}async function he(r,o,f,e){var t;if(r.type==="sort"){if(f)t=await re(r,f,e);else{var i=await re(r,o,e);t=F(),t.tupleStream=!0;for(var l=0;l<i.length;l++){var u={"@":i[l]};u[r.index]=l,t.push(u)}}return r.stages&&(t=await de(r.stages,t,e)),t}t=F(),t.tupleStream=!0;var g=e;f===void 0&&(f=o.map(ye=>({"@":ye})));for(var T=0;T<f.length;T++){g=te(e,f[T]);var I=await C(r,f[T]["@"],g);if(typeof I<"u"){Array.isArray(I)||(I=[I]);for(var W=0;W<I.length;W++)u={},Object.assign(u,f[T]),I.tupleStream?Object.assign(u,I[W]):(r.focus?(u[r.focus]=I[W],u["@"]=f[T]["@"]):u["@"]=I[W],r.index&&(u[r.index]=W),r.ancestor&&(u[r.ancestor.label]=f[T]["@"])),t.push(u)}}return r.stages&&(t=await de(r.stages,t,e)),t}async function ie(r,o,f){var e=F();if(o&&o.tupleStream&&(e.tupleStream=!0),Array.isArray(o)||(o=F(o)),r.type==="number"){var t=Math.floor(r.value);t<0&&(t=o.length+t);var i=o[t];typeof i<"u"&&(Array.isArray(i)?e=i:e.push(i))}else for(t=0;t<o.length;t++){var i=o[t],l=i,u=f;o.tupleStream&&(l=i["@"],u=te(f,i));var g=await C(r,l,u);$(g)&&(g=[g]),E(g)?g.forEach(function(I){var W=Math.floor(I);W<0&&(W=o.length+W),W===t&&e.push(i)}):h.boolean(g)&&e.push(i)}return e}async function ke(r,o,f){var e,t=await C(r.lhs,o,f),i=r.value,l=async()=>await C(r.rhs,o,f);if(i==="and"||i==="or")try{return await ge(t,l,i)}catch(g){throw g.position=r.position,g.token=i,g}var u=await l();try{switch(i){case"+":case"-":case"*":case"/":case"%":e=s(t,u,i);break;case"=":case"!=":e=c(t,u,i);break;case"<":case"<=":case">":case">=":e=R(t,u,i);break;case"&":e=v(t,u);break;case"..":e=P(t,u);break;case"in":e=ee(t,u);break}}catch(g){throw g.position=r.position,g.token=i,g}return e}async function Le(r,o,f){var e;switch(r.value){case"-":if(e=await C(r.expression,o,f),typeof e>"u")e=void 0;else if($(e))e=-e;else throw{code:"D1002",stack:new Error().stack,position:r.position,token:r.value,value:e};break;case"[":e=[];let l=await Promise.all(r.expressions.map(async(u,g)=>(f.isParallelCall=g>0,[u,await C(u,o,f)])));for(let u of l){var[t,i]=u;typeof i<"u"&&(t.value==="["?e.push(i):e=h.append(e,i))}r.consarray&&Object.defineProperty(e,"cons",{enumerable:!1,configurable:!1,value:!0});break;case"{":e=await b(r,o,f);break}return e}function fe(r,o,f){return h.lookup(o,r.value)}function K(r){return r.value}function ze(r,o){var f=F();return Array.isArray(o)&&o.outerWrapper&&o.length>0&&(o=o[0]),o!==null&&typeof o=="object"&&Object.keys(o).forEach(function(e){var t=o[e];Array.isArray(t)?(t=J(t),f=h.append(f,t)):f.push(t)}),f}function J(r,o){return typeof o>"u"&&(o=[]),Array.isArray(r)?r.forEach(function(f){J(f,o)}):o.push(r),o}function $e(r,o){var f,e=F();return typeof o<"u"&&(We(o,e),e.length===1?f=e[0]:f=e),f}function We(r,o){Array.isArray(r)||o.push(r),Array.isArray(r)?r.forEach(function(f){We(f,o)}):r!==null&&typeof r=="object"&&Object.keys(r).forEach(function(f){We(r[f],o)})}function s(r,o,f){var e;if(typeof r<"u"&&!$(r))throw{code:"T2001",stack:new Error().stack,value:r};if(typeof o<"u"&&!$(o))throw{code:"T2002",stack:new Error().stack,value:o};if(typeof r>"u"||typeof o>"u")return e;switch(f){case"+":e=r+o;break;case"-":e=r-o;break;case"*":e=r*o;break;case"/":e=r/o;break;case"%":e=r%o;break}return e}function c(r,o,f){var e,t=typeof r,i=typeof o;if(t==="undefined"||i==="undefined")return!1;switch(f){case"=":e=j(r,o);break;case"!=":e=!j(r,o);break}return e}function R(r,o,f){var e,t=typeof r,i=typeof o,l=t==="undefined"||t==="string"||t==="number",u=i==="undefined"||i==="string"||i==="number";if(!l||!u)throw{code:"T2010",stack:new Error().stack,value:t==="string"||t==="number"?o:r};if(!(t==="undefined"||i==="undefined")){if(t!==i)throw{code:"T2009",stack:new Error().stack,value:r,value2:o};switch(f){case"<":e=r<o;break;case"<=":e=r<=o;break;case">":e=r>o;break;case">=":e=r>=o;break}return e}}function ee(r,o){var f=!1;if(typeof r>"u"||typeof o>"u")return!1;Array.isArray(o)||(o=[o]);for(var e=0;e<o.length;e++)if(o[e]===r){f=!0;break}return f}async function ge(r,o,f){var e,t=ce(r);switch(f){case"and":e=t&&ce(await o());break;case"or":e=t||ce(await o());break}return e}function ce(r){var o=h.boolean(r);return typeof o>"u"?!1:o}function v(r,o){var f,e="",t="";return typeof r<"u"&&(e=h.string(r)),typeof o<"u"&&(t=h.string(o)),f=e.concat(t),f}async function b(r,o,f){var e={},t={},i=!!(o&&o.tupleStream);Array.isArray(o)||(o=F(o)),o.length===0&&o.push(void 0);for(var l=0;l<o.length;l++)for(var u=o[l],g=i?te(f,u):f,T=0;T<r.lhs.length;T++){var I=r.lhs[T],W=await C(I[0],i?u["@"]:u,g);if(typeof W!="string"&&W!==void 0)throw{code:"T1003",stack:new Error().stack,position:r.position,value:W};if(W!==void 0){var ye={data:u,exprIndex:T};if(t.hasOwnProperty(W)){if(t[W].exprIndex!==T)throw{code:"D1009",stack:new Error().stack,position:r.position,value:W};t[W].data=h.append(t[W].data,u)}else t[W]=ye}}let ne=await Promise.all(Object.keys(t).map(async(pe,Oe)=>{let se=t[pe];var _e=se.data,Ye=f;if(i){var Ce=y(se.data);_e=Ce["@"],delete Ce["@"],Ye=te(f,Ce)}return f.isParallelCall=Oe>0,[pe,await C(r.lhs[se.exprIndex][1],_e,Ye)]}));for(let pe of ne){var[W,be]=await pe;typeof be<"u"&&(e[W]=be)}return e}function y(r){if(!Array.isArray(r))return r;var o={};Object.assign(o,r[0]);for(var f=1;f<r.length;f++)for(const e in r[f])o[e]=h.append(o[e],r[f][e]);return o}function P(r,o){var f;if(typeof r<"u"&&!Number.isInteger(r))throw{code:"T2003",stack:new Error().stack,value:r};if(typeof o<"u"&&!Number.isInteger(o))throw{code:"T2004",stack:new Error().stack,value:o};if(typeof r>"u"||typeof o>"u"||r>o)return f;var e=o-r+1;if(e>1e7)throw{code:"D2014",stack:new Error().stack,value:e};f=new Array(e);for(var t=r,i=0;t<=o;t++,i++)f[i]=t;return f.sequence=!0,f}async function O(r,o,f){var e=await C(r.rhs,o,f);return f.bind(r.lhs.value,e),e}async function D(r,o,f){var e,t=await C(r.condition,o,f);return h.boolean(t)?e=await C(r.then,o,f):typeof r.else<"u"&&(e=await C(r.else,o,f)),e}async function A(r,o,f){for(var e,t=Ve(f),i=0;i<r.expressions.length;i++)e=await C(r.expressions[i],o,t);return e}function x(r){var o=new ve.RegexEngine(r.value),f=function(e,t){var i;o.lastIndex=t||0;var l=o.exec(e);if(l!==null){if(i={match:l[0],start:l.index,end:l.index+l[0].length,groups:[]},l.length>1)for(var u=1;u<l.length;u++)i.groups.push(l[u]);i.next=function(){if(!(o.lastIndex>=e.length)){var g=f(e,o.lastIndex);if(g&&g.match==="")throw{code:"D1004",stack:new Error().stack,position:r.position,value:r.value.source};return g}}}return i};return f}function q(r,o,f){var e;return r.value===""?e=o&&o.outerWrapper?o[0]:o:e=f.lookup(r.value),e}async function re(r,o,f){var e,t=o,i=!!o.tupleStream,l=async function(g,T){for(var I=0,W=0;I===0&&W<r.terms.length;W++){var ye=r.terms[W],ne=g,be=f;i&&(ne=g["@"],be=te(f,g));var pe=await C(ye.expression,ne,be);ne=T,be=f,i&&(ne=T["@"],be=te(f,T));var Oe=await C(ye.expression,ne,be),se=typeof pe,_e=typeof Oe;if(se==="undefined"){I=_e==="undefined"?0:1;continue}if(_e==="undefined"){I=-1;continue}if(!(se==="string"||se==="number")||!(_e==="string"||_e==="number"))throw{code:"T2008",stack:new Error().stack,position:r.position,value:se==="string"||se==="number"?Oe:pe};if(se!==_e)throw{code:"T2007",stack:new Error().stack,position:r.position,value:pe,value2:Oe};pe!==Oe&&(pe<Oe?I=-1:I=1,ye.descending===!0&&(I=-I))}return I===1},u={environment:f,input:o};return e=await h.sort.apply(u,[t,l]),e}function ae(r,o,f){var e=async function(t){if(!(typeof t>"u")){var i=f.lookup("clone");if(!we(i))throw{code:"T2013",stack:new Error().stack,position:r.position};var l=await z(i,[t],null,f),u=await C(r.pattern,l,f);if(typeof u<"u"){Array.isArray(u)||(u=[u]);for(var g=0;g<u.length;g++){var T=u[g];if(T&&(T.isPrototypeOf(l)||T instanceof Object.constructor))throw{code:"D1010",stack:new Error().stack,position:r.position};var I=await C(r.update,T,f),W=typeof I;if(W!=="undefined"){if(W!=="object"||I===null||Array.isArray(I))throw{code:"T2011",stack:new Error().stack,position:r.update.position,value:I};for(var ye in I)T[ye]=I[ye]}if(typeof r.delete<"u"){var ne=await C(r.delete,T,f);if(typeof ne<"u"){var be=ne;if(Array.isArray(ne)||(ne=[ne]),!k(ne))throw{code:"T2012",stack:new Error().stack,position:r.delete.position,value:be};for(var pe=0;pe<ne.length;pe++)typeof T=="object"&&T!==null&&delete T[ne[pe]]}}}}return l}};return M(e,"<(oa):o>")}var H=N("function($f, $g) { function($x){ $g($f($x)) } }");async function Y(r,o,f){var e,t=await C(r.lhs,o,f);if(r.rhs.type==="function")e=await le(r.rhs,o,f,{context:t});else{var i=await C(r.rhs,o,f);if(!we(i))throw{code:"T2006",stack:new Error().stack,position:r.position,value:i};if(we(t)){var l=await C(H,null,f);e=await z(l,[t,i],null,f)}else e=await z(i,[t],null,f)}return e}async function le(r,o,f,e){var t,i=await C(r.procedure,o,f);if(typeof i>"u"&&r.procedure.type==="path"&&f.lookup(r.procedure.steps[0].value))throw{code:"T1005",stack:new Error().stack,position:r.position,token:r.procedure.steps[0].value};var l=[];typeof e<"u"&&l.push(e.context);for(var u=0;u<r.arguments.length;u++){const T=await C(r.arguments[u],o,f);if(we(T)){const I=async function(...W){return await z(T,W,null,f)};I.arity=Z(T),l.push(I)}else l.push(T)}var g=r.procedure.type==="path"?r.procedure.steps[0].value:r.procedure.value;try{typeof i=="object"&&(i.token=g,i.position=r.position),t=await z(i,l,o,f)}catch(T){throw T.position||(T.position=r.position),T.token||(T.token=g),T}return t}async function z(r,o,f,e){var t;for(t=await De(r,o,f,e);me(t)&&t.thunk===!0;){var i=await C(t.body.procedure,t.input,t.environment);t.body.procedure.type==="variable"&&(i.token=t.body.procedure.value),i.position=t.body.procedure.position;for(var l=[],u=0;u<t.body.arguments.length;u++)l.push(await C(t.body.arguments[u],t.input,t.environment));t=await De(i,l,f,e)}return t}async function De(r,o,f,e){var t;try{var i=o;if(r&&(i=Pe(r.signature,o,f)),me(r))t=await Ne(r,i);else if(r&&r._jsonata_function===!0){var l={environment:e,input:f};t=r.implementation.apply(l,i),B(t)&&(t=t.next().value),S(t)&&(t=await t)}else if(typeof r=="function")t=r.apply(f,i),S(t)&&(t=await t);else throw{code:"T1006",stack:new Error().stack}}catch(u){throw r&&(typeof u.token>"u"&&typeof r.token<"u"&&(u.token=r.token),u.position=r.position||u.position),u}return t}function Be(r,o,f){var e={_jsonata_lambda:!0,input:o,environment:f,arguments:r.arguments,signature:r.signature,body:r.body};return r.thunk===!0&&(e.thunk=!0),e.apply=async function(t,i){return await z(e,i,o,t?t.environment:f)},e}async function Ue(r,o,f){for(var e,t=[],i=0;i<r.arguments.length;i++){var l=r.arguments[i];l.type==="operator"&&l.value==="?"?t.push(l):t.push(await C(l,o,f))}var u=await C(r.procedure,o,f);if(typeof u>"u"&&r.procedure.type==="path"&&f.lookup(r.procedure.steps[0].value))throw{code:"T1007",stack:new Error().stack,position:r.position,token:r.procedure.steps[0].value};if(me(u))e=Ze(u,t);else if(u&&u._jsonata_function===!0)e=Qe(u.implementation,t);else if(typeof u=="function")e=Qe(u,t);else throw{code:"T1008",stack:new Error().stack,position:r.position,token:r.procedure.type==="path"?r.procedure.steps[0].value:r.procedure.value};return e}function Pe(r,o,f){if(typeof r>"u")return o;var e=r.validate(o,f);return e}async function Ne(r,o){var f,e=Ve(r.environment);return r.arguments.forEach(function(t,i){e.bind(t.value,o[i])}),typeof r.body=="function"?f=await Pt(r.body,e):f=await C(r.body,r.input,e),f}function Ze(r,o){var f=Ve(r.environment),e=[];r.arguments.forEach(function(i,l){var u=o[l];u&&u.type==="operator"&&u.value==="?"?e.push(i):f.bind(i.value,u)});var t={_jsonata_lambda:!0,input:r.input,environment:f,arguments:e,body:r.body};return t}function Qe(r,o){var f=Ke(r);f=f.map(function(l){return"$"+l.trim()});var e="function("+f.join(", ")+"){ _ }",t=N(e);t.body=r;var i=Ze(t,o);return i}async function Pt(r,o){var f=Ke(r),e=f.map(function(l){return o.lookup(l.trim())}),t={environment:o},i=r.apply(t,e);return S(i)&&(i=await i),i}function Ke(r){var o=r.toString(),f=/\(([^)]*)\)/.exec(o)[1],e=f.split(",");return e}function M(r,o){var f={_jsonata_function:!0,implementation:r};return typeof o<"u"&&(f.signature=G(o)),f}async function Tt(r,o){if(!(typeof r>"u")){var f=this.input;typeof o<"u"&&(f=o,Array.isArray(f)&&!oe(f)&&(f=F(f),f.outerWrapper=!0));try{var e=N(r,!1)}catch(i){throw Je(i),{stack:new Error().stack,code:"D3120",value:i.message,error:i}}try{var t=await C(e,f,this.environment)}catch(i){throw Je(i),{stack:new Error().stack,code:"D3121",value:i.message,error:i}}return t}}function yt(r){if(!(typeof r>"u"))return JSON.parse(h.string(r))}function Ve(r){var o={};return{bind:function(f,e){o[f]=e},lookup:function(f){var e;return o.hasOwnProperty(f)?e=o[f]:r&&(e=r.lookup(f)),e},timestamp:r?r.timestamp:null,async:r?r.async:!1,isParallelCall:r?r.isParallelCall:!1,global:r?r.global:{ancestry:[null]}}}m.bind("sum",M(h.sum,"<a<n>:n>")),m.bind("count",M(h.count,"<a:n>")),m.bind("max",M(h.max,"<a<n>:n>")),m.bind("min",M(h.min,"<a<n>:n>")),m.bind("average",M(h.average,"<a<n>:n>")),m.bind("string",M(h.string,"<x-b?:s>")),m.bind("substring",M(h.substring,"<s-nn?:s>")),m.bind("substringBefore",M(h.substringBefore,"<s-s:s>")),m.bind("substringAfter",M(h.substringAfter,"<s-s:s>")),m.bind("lowercase",M(h.lowercase,"<s-:s>")),m.bind("uppercase",M(h.uppercase,"<s-:s>")),m.bind("length",M(h.length,"<s-:n>")),m.bind("trim",M(h.trim,"<s-:s>")),m.bind("pad",M(h.pad,"<s-ns?:s>")),m.bind("match",M(h.match,"<s-f<s:o>n?:a<o>>")),m.bind("contains",M(h.contains,"<s-(sf):b>")),m.bind("replace",M(h.replace,"<s-(sf)(sf)n?:s>")),m.bind("split",M(h.split,"<s-(sf)n?:a<s>>")),m.bind("join",M(h.join,"<a<s>s?:s>")),m.bind("formatNumber",M(h.formatNumber,"<n-so?:s>")),m.bind("formatBase",M(h.formatBase,"<n-n?:s>")),m.bind("formatInteger",M(w.formatInteger,"<n-s:s>")),m.bind("parseInteger",M(w.parseInteger,"<s-s:n>")),m.bind("number",M(h.number,"<(nsb)-:n>")),m.bind("floor",M(h.floor,"<n-:n>")),m.bind("ceil",M(h.ceil,"<n-:n>")),m.bind("round",M(h.round,"<n-n?:n>")),m.bind("abs",M(h.abs,"<n-:n>")),m.bind("sqrt",M(h.sqrt,"<n-:n>")),m.bind("power",M(h.power,"<n-n:n>")),m.bind("random",M(h.random,"<:n>")),m.bind("boolean",M(h.boolean,"<x-:b>")),m.bind("not",M(h.not,"<x-:b>")),m.bind("map",M(h.map,"<af>")),m.bind("zip",M(h.zip,"<a+>")),m.bind("filter",M(h.filter,"<af>")),m.bind("single",M(h.single,"<af?>")),m.bind("reduce",M(h.foldLeft,"<afj?:j>")),m.bind("sift",M(h.sift,"<o-f?:o>")),m.bind("keys",M(h.keys,"<x-:a<s>>")),m.bind("lookup",M(h.lookup,"<x-s:x>")),m.bind("append",M(h.append,"<xx:a>")),m.bind("exists",M(h.exists,"<x:b>")),m.bind("spread",M(h.spread,"<x-:a<o>>")),m.bind("merge",M(h.merge,"<a<o>:o>")),m.bind("reverse",M(h.reverse,"<a:a>")),m.bind("each",M(h.each,"<o-f:a>")),m.bind("error",M(h.error,"<s?:x>")),m.bind("assert",M(h.assert,"<bs?:x>")),m.bind("type",M(h.type,"<x:s>")),m.bind("sort",M(h.sort,"<af?:a>")),m.bind("shuffle",M(h.shuffle,"<a:a>")),m.bind("distinct",M(h.distinct,"<x:x>")),m.bind("base64encode",M(h.base64encode,"<s-:s>")),m.bind("base64decode",M(h.base64decode,"<s-:s>")),m.bind("encodeUrlComponent",M(h.encodeUrlComponent,"<s-:s>")),m.bind("encodeUrl",M(h.encodeUrl,"<s-:s>")),m.bind("decodeUrlComponent",M(h.decodeUrlComponent,"<s-:s>")),m.bind("decodeUrl",M(h.decodeUrl,"<s-:s>")),m.bind("eval",M(Tt,"<sx?:x>")),m.bind("toMillis",M(w.toMillis,"<s-s?:n>")),m.bind("fromMillis",M(w.fromMillis,"<n-s?s?:s>")),m.bind("clone",M(yt,"<(oa)-:o>"));var ut={S0101:"String literal must be terminated by a matching quote",S0102:"Number out of range: {{token}}",S0103:"Unsupported escape sequence: \\{{token}}",S0104:"The escape sequence \\u must be followed by 4 hex digits",S0105:"Quoted property name must be terminated with a backquote (`)",S0106:"Comment has no closing tag",S0201:"Syntax error: {{token}}",S0202:"Expected {{value}}, got {{token}}",S0203:"Expected {{value}} before end of expression",S0204:"Unknown operator: {{token}}",S0205:"Unexpected token: {{token}}",S0206:"Unknown expression type: {{token}}",S0207:"Unexpected end of expression",S0208:"Parameter {{value}} of function definition must be a variable name (start with $)",S0209:"A predicate cannot follow a grouping expression in a step",S0210:"Each step can only have one grouping expression",S0211:"The symbol {{token}} cannot be used as a unary operator",S0212:"The left side of := must be a variable name (start with $)",S0213:"The literal value {{value}} cannot be used as a step within a path expression",S0214:"The right side of {{token}} must be a variable name (start with $)",S0215:"A context variable binding must precede any predicates on a step",S0216:"A context variable binding must precede the 'order-by' clause on a step",S0217:"The object representing the 'parent' cannot be derived from this expression",S0301:"Empty regular expressions are not allowed",S0302:"No terminating / in regular expression",S0402:"Choice groups containing parameterized types are not supported",S0401:"Type parameters can only be applied to functions and arrays",S0500:"Attempted to evaluate an expression containing syntax error(s)",T0410:"Argument {{index}} of function {{token}} does not match function signature",T0411:"Context value is not a compatible type with argument {{index}} of function {{token}}",T0412:"Argument {{index}} of function {{token}} must be an array of {{type}}",D1001:"Number out of range: {{value}}",D1002:"Cannot negate a non-numeric value: {{value}}",T1003:"Key in object structure must evaluate to a string; got: {{value}}",D1004:"Regular expression matches zero length string",T1005:"Attempted to invoke a non-function. Did you mean ${{{token}}}?",T1006:"Attempted to invoke a non-function",T1007:"Attempted to partially apply a non-function. Did you mean ${{{token}}}?",T1008:"Attempted to partially apply a non-function",D1009:"Multiple key definitions evaluate to same key: {{value}}",D1010:"Attempted to access the Javascript object prototype",T1010:"The matcher function argument passed to function {{token}} does not return the correct object structure",T2001:"The left side of the {{token}} operator must evaluate to a number",T2002:"The right side of the {{token}} operator must evaluate to a number",T2003:"The left side of the range operator (..) must evaluate to an integer",T2004:"The right side of the range operator (..) must evaluate to an integer",D2005:"The left side of := must be a variable name (start with $)",T2006:"The right side of the function application operator ~> must be a function",T2007:"Type mismatch when comparing values {{value}} and {{value2}} in order-by clause",T2008:"The expressions within an order-by clause must evaluate to numeric or string values",T2009:"The values {{value}} and {{value2}} either side of operator {{token}} must be of the same data type",T2010:"The expressions either side of operator {{token}} must evaluate to numeric or string values",T2011:"The insert/update clause of the transform expression must evaluate to an object: {{value}}",T2012:"The delete clause of the transform expression must evaluate to a string or array of strings: {{value}}",T2013:"The transform expression clones the input object using the $clone() function.  This has been overridden in the current scope by a non-function.",D2014:"The size of the sequence allocated by the range operator (..) must not exceed 1e6.  Attempted to allocate {{value}}.",D3001:"Attempting to invoke string function on Infinity or NaN",D3010:"Second argument of replace function cannot be an empty string",D3011:"Fourth argument of replace function must evaluate to a positive number",D3012:"Attempted to replace a matched string with a non-string value",D3020:"Third argument of split function must evaluate to a positive number",D3030:"Unable to cast value to a number: {{value}}",D3040:"Third argument of match function must evaluate to a positive number",D3050:"The second argument of reduce function must be a function with at least two arguments",D3060:"The sqrt function cannot be applied to a negative number: {{value}}",D3061:"The power function has resulted in a value that cannot be represented as a JSON number: base={{value}}, exponent={{exp}}",D3070:"The single argument form of the sort function can only be applied to an array of strings or an array of numbers.  Use the second argument to specify a comparison function",D3080:"The picture string must only contain a maximum of two sub-pictures",D3081:"The sub-picture must not contain more than one instance of the 'decimal-separator' character",D3082:"The sub-picture must not contain more than one instance of the 'percent' character",D3083:"The sub-picture must not contain more than one instance of the 'per-mille' character",D3084:"The sub-picture must not contain both a 'percent' and a 'per-mille' character",D3085:"The mantissa part of a sub-picture must contain at least one character that is either an 'optional digit character' or a member of the 'decimal digit family'",D3086:"The sub-picture must not contain a passive character that is preceded by an active character and that is followed by another active character",D3087:"The sub-picture must not contain a 'grouping-separator' character that appears adjacent to a 'decimal-separator' character",D3088:"The sub-picture must not contain a 'grouping-separator' at the end of the integer part",D3089:"The sub-picture must not contain two adjacent instances of the 'grouping-separator' character",D3090:"The integer part of the sub-picture must not contain a member of the 'decimal digit family' that is followed by an instance of the 'optional digit character'",D3091:"The fractional part of the sub-picture must not contain an instance of the 'optional digit character' that is followed by a member of the 'decimal digit family'",D3092:"A sub-picture that contains a 'percent' or 'per-mille' character must not contain a character treated as an 'exponent-separator'",D3093:"The exponent part of the sub-picture must comprise only of one or more characters that are members of the 'decimal digit family'",D3100:"The radix of the formatBase function must be between 2 and 36.  It was given {{value}}",D3110:"The argument of the toMillis function must be an ISO 8601 formatted timestamp. Given {{value}}",D3120:"Syntax error in expression passed to function eval: {{value}}",D3121:"Dynamic error evaluating the expression passed to function eval: {{value}}",D3130:"Formatting or parsing an integer as a sequence starting with {{value}} is not supported by this implementation",D3131:"In a decimal digit pattern, all digits must be from the same decimal group",D3132:"Unknown component specifier {{value}} in date/time picture string",D3133:"The 'name' modifier can only be applied to months and days in the date/time picture string, not {{value}}",D3134:"The timezone integer format specifier cannot have more than four digits",D3135:"No matching closing bracket ']' in date/time picture string",D3136:"The date/time picture string is missing specifiers required to parse the timestamp",D3137:"{{{message}}}",D3138:"The $single() function expected exactly 1 matching result.  Instead it matched more.",D3139:"The $single() function expected exactly 1 matching result.  Instead it matched 0.",D3140:"Malformed URL passed to ${{{functionName}}}(): {{value}}",D3141:"{{{message}}}"};function Je(r){var o=ut[r.code];if(typeof o<"u"){var f=o.replace(/\{\{\{([^}]+)}}}/g,function(){return r[arguments[1]]});f=f.replace(/\{\{([^}]+)}}/g,function(){return JSON.stringify(r[arguments[1]])}),r.message=f}}function ve(r,o){var f,e;try{f=N(r,o&&o.recover),e=f.errors,delete f.errors}catch(l){throw Je(l),l}var t=Ve(m),i=new Date;return t.bind("now",M(function(l,u){return w.fromMillis(i.getTime(),l,u)},"<s?s?:s>")),t.bind("millis",M(function(){return i.getTime()},"<:n>")),o&&o.RegexEngine?ve.RegexEngine=o.RegexEngine:ve.RegexEngine=RegExp,{evaluate:async function(l,u,g){if(typeof e<"u"){var T={code:"S0500",position:0};throw Je(T),T}if(typeof u<"u"){var I;I=Ve(t);for(var W in u)I.bind(W,u[W])}else I=t;I.bind("$",l),i=new Date,I.timestamp=i,Array.isArray(l)&&!oe(l)&&(l=F(l),l.outerWrapper=!0);var ye;try{return ye=await C(f,l,I),typeof g=="function"&&g(null,ye),ye}catch(ne){throw Je(ne),ne}},assign:function(l,u){t.bind(l,u)},registerFunction:function(l,u,g){var T=M(u,g);t.bind(l,T)},ast:function(){return f},errors:function(){return e}}}return ve.parser=N,ve}();d.exports=X},{"./datetime":1,"./functions":2,"./parser":4,"./signature":5,"./utils":6}],4:[function(a,d,p){var w=a("./signature");const h=(()=>{var U={".":75,"[":80,"]":0,"{":70,"}":0,"(":80,")":0,",":0,"@":80,"#":80,";":80,":":80,"?":20,"+":50,"-":50,"*":60,"/":60,"%":60,"|":20,"=":40,"<":40,">":40,"^":40,"**":60,"..":20,":=":10,"!=":40,"<=":40,">=":40,"~>":40,and:30,or:25,in:40,"&":50,"!":0,"~":0},N={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:`
`,r:"\r",t:"	"},G=function($){var k=0,E=$.length,F=function(me,B){var S={type:me,value:B,position:k};return S},oe=function(){for(var me=k,B=0,S,Z,j=function(C){if($.charAt(C)==="/"&&B===0){for(var L=0;$.charAt(C-(L+1))==="\\";)L++;if(L%2===0)return!0}return!1};k<E;){var m=$.charAt(k);if(j(k)){if(S=$.substring(me,k),S==="")throw{code:"S0301",stack:new Error().stack,position:k};for(k++,m=$.charAt(k),me=k;m==="i"||m==="m";)k++,m=$.charAt(k);return Z=$.substring(me,k)+"g",new RegExp(S,Z)}(m==="("||m==="["||m==="{")&&$.charAt(k-1)!=="\\"&&B++,(m===")"||m==="]"||m==="}")&&$.charAt(k-1)!=="\\"&&B--,k++}throw{code:"S0302",stack:new Error().stack,position:k}},we=function(me){if(k>=E)return null;for(var B=$.charAt(k);k<E&&` 	
\r\v`.indexOf(B)>-1;)k++,B=$.charAt(k);if(B==="/"&&$.charAt(k+1)==="*"){var S=k;for(k+=2,B=$.charAt(k);!(B==="*"&&$.charAt(k+1)==="/");)if(B=$.charAt(++k),k>=E)throw{code:"S0106",stack:new Error().stack,position:S};return k+=2,B=$.charAt(k),we(me)}if(me!==!0&&B==="/")return k++,F("regex",oe());if(B==="."&&$.charAt(k+1)===".")return k+=2,F("operator","..");if(B===":"&&$.charAt(k+1)==="=")return k+=2,F("operator",":=");if(B==="!"&&$.charAt(k+1)==="=")return k+=2,F("operator","!=");if(B===">"&&$.charAt(k+1)==="=")return k+=2,F("operator",">=");if(B==="<"&&$.charAt(k+1)==="=")return k+=2,F("operator","<=");if(B==="*"&&$.charAt(k+1)==="*")return k+=2,F("operator","**");if(B==="~"&&$.charAt(k+1)===">")return k+=2,F("operator","~>");if(Object.prototype.hasOwnProperty.call(U,B))return k++,F("operator",B);if(B==='"'||B==="'"){var Z=B;k++;for(var j="";k<E;){if(B=$.charAt(k),B==="\\")if(k++,B=$.charAt(k),Object.prototype.hasOwnProperty.call(N,B))j+=N[B];else if(B==="u"){var m=$.substr(k+1,4);if(/^[0-9a-fA-F]+$/.test(m)){var C=parseInt(m,16);j+=String.fromCharCode(C),k+=4}else throw{code:"S0104",stack:new Error().stack,position:k}}else throw{code:"S0103",stack:new Error().stack,position:k,token:B};else{if(B===Z)return k++,F("string",j);j+=B}k++}throw{code:"S0101",stack:new Error().stack,position:k}}var L=/^-?(0|([1-9][0-9]*))(\.[0-9]+)?([Ee][-+]?[0-9]+)?/,te=L.exec($.substring(k));if(te!==null){var ue=parseFloat(te[0]);if(!isNaN(ue)&&isFinite(ue))return k+=te[0].length,F("number",ue);throw{code:"S0102",stack:new Error().stack,position:k,token:te[0]}}var de;if(B==="`"){k++;var he=$.indexOf("`",k);if(he!==-1)return de=$.substring(k,he),k=he+1,F("name",de);throw k=E,{code:"S0105",stack:new Error().stack,position:k}}for(var ie=k,ke;;)if(ke=$.charAt(ie),ie===E||` 	
\r\v`.indexOf(ke)>-1||Object.prototype.hasOwnProperty.call(U,ke)){if($.charAt(k)==="$")return de=$.substring(k+1,ie),k=ie,F("variable",de);switch(de=$.substring(k,ie),k=ie,de){case"or":case"in":case"and":return F("operator",de);case"true":return F("value",!0);case"false":return F("value",!1);case"null":return F("value",null);default:return k===E&&de===""?null:F("name",de)}}else ie++};return we},X=function($,k){var E,F,oe={},we=[],me=function(){var s=[];E.id!=="(end)"&&s.push({type:E.type,value:E.value,position:E.position});for(var c=F();c!==null;)s.push(c),c=F();return s},B={nud:function(){var s={code:"S0211",token:this.value,position:this.position};if(k)return s.remaining=me(),s.type="error",we.push(s),s;throw s.stack=new Error().stack,s}},S=function(s,c){var R=oe[s];return c=c||0,R?c>=R.lbp&&(R.lbp=c):(R=Object.create(B),R.id=R.value=s,R.lbp=c,oe[s]=R),R},Z=function(s){if(k){s.remaining=me(),we.push(s);var c=oe["(error)"];return E=Object.create(c),E.error=s,E.type="(error)",E}else throw s.stack=new Error().stack,s},j=function(s,c){if(s&&E.id!==s){var R;E.id==="(end)"?R="S0203":R="S0202";var ee={code:R,position:E.position,token:E.value,value:s};return Z(ee)}var ge=F(c);if(ge===null)return E=oe["(end)"],E.position=$.length,E;var ce=ge.value,v=ge.type,b;switch(v){case"name":case"variable":b=oe["(name)"];break;case"operator":if(b=oe[ce],!b)return Z({code:"S0204",stack:new Error().stack,position:ge.position,token:ce});break;case"string":case"number":case"value":b=oe["(literal)"];break;case"regex":v="regex",b=oe["(regex)"];break;default:return Z({code:"S0205",stack:new Error().stack,position:ge.position,token:ce})}return E=Object.create(b),E.value=ce,E.type=v,E.position=ge.position,E},m=function(s){var c,R=E;for(j(null,!0),c=R.nud();s<E.lbp;)R=E,j(),c=R.led(c);return c},C=function(s){var c=S(s,0);c.nud=function(){return this}},L=function(s,c,R){var ee=c||U[s],ge=S(s,ee);return ge.led=R||function(ce){return this.lhs=ce,this.rhs=m(ee),this.type="binary",this},ge},te=function(s,c,R){var ee=S(s,c);return ee.led=R,ee},ue=function(s,c){var R=S(s);return R.nud=c||function(){return this.expression=m(70),this.type="unary",this},R};C("(end)"),C("(name)"),C("(literal)"),C("(regex)"),S(":"),S(";"),S(","),S(")"),S("]"),S("}"),S(".."),L("."),L("+"),L("-"),L("*"),L("/"),L("%"),L("="),L("<"),L(">"),L("!="),L("<="),L(">="),L("&"),L("and"),L("or"),L("in"),C("and"),C("or"),C("in"),ue("-"),L("~>"),te("(error)",10,function(s){return this.lhs=s,this.error=E.error,this.remaining=me(),this.type="error",this}),ue("*",function(){return this.type="wildcard",this}),ue("**",function(){return this.type="descendant",this}),ue("%",function(){return this.type="parent",this}),L("(",U["("],function(s){if(this.procedure=s,this.type="function",this.arguments=[],E.id!==")")for(;E.type==="operator"&&E.id==="?"?(this.type="partial",this.arguments.push(E),j("?")):this.arguments.push(m(0)),E.id===",";)j(",");if(j(")",!0),s.type==="name"&&(s.value==="function"||s.value==="λ")){if(this.arguments.forEach(function(ce,v){if(ce.type!=="variable")return Z({code:"S0208",stack:new Error().stack,position:ce.position,token:ce.value,value:v+1})}),this.type="lambda",E.id==="<"){for(var c=E.position,R=1,ee="<";R>0&&E.id!=="{"&&E.id!=="(end)";){var ge=j();ge.id===">"?R--:ge.id==="<"&&R++,ee+=ge.value}j(">");try{this.signature=w(ee)}catch(ce){return ce.position=c+ce.offset,Z(ce)}}j("{"),this.body=m(0),j("}")}return this}),ue("(",function(){for(var s=[];E.id!==")"&&(s.push(m(0)),E.id===";");)j(";");return j(")",!0),this.type="block",this.expressions=s,this}),ue("[",function(){var s=[];if(E.id!=="]")for(;;){var c=m(0);if(E.id===".."){var R={type:"binary",value:"..",position:E.position,lhs:c};j(".."),R.rhs=m(0),c=R}if(s.push(c),E.id!==",")break;j(",")}return j("]",!0),this.expressions=s,this.type="unary",this}),L("[",U["["],function(s){if(E.id==="]"){for(var c=s;c&&c.type==="binary"&&c.value==="[";)c=c.lhs;return c.keepArray=!0,j("]"),s}else return this.lhs=s,this.rhs=m(U["]"]),this.type="binary",j("]",!0),this}),L("^",U["^"],function(s){j("(");for(var c=[];;){var R={descending:!1};if(E.id==="<"?j("<"):E.id===">"&&(R.descending=!0,j(">")),R.expression=m(0),c.push(R),E.id!==",")break;j(",")}return j(")"),this.lhs=s,this.rhs=c,this.type="binary",this});var de=function(s){var c=[];if(E.id!=="}")for(;;){var R=m(0);j(":");var ee=m(0);if(c.push([R,ee]),E.id!==",")break;j(",")}return j("}",!0),typeof s>"u"?(this.lhs=c,this.type="unary"):(this.lhs=s,this.rhs=c,this.type="binary"),this};ue("{",de),L("{",U["{"],de),te(":=",U[":="],function(s){return s.type!=="variable"?Z({code:"S0212",stack:new Error().stack,position:s.position,token:s.value}):(this.lhs=s,this.rhs=m(U[":="]-1),this.type="binary",this)}),L("@",U["@"],function(s){return this.lhs=s,this.rhs=m(U["@"]),this.rhs.type!=="variable"?Z({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"@"}):(this.type="binary",this)}),L("#",U["#"],function(s){return this.lhs=s,this.rhs=m(U["#"]),this.rhs.type!=="variable"?Z({code:"S0214",stack:new Error().stack,position:this.rhs.position,token:"#"}):(this.type="binary",this)}),L("?",U["?"],function(s){return this.type="condition",this.condition=s,this.then=m(0),E.id===":"&&(j(":"),this.else=m(0)),this}),ue("|",function(){return this.type="transform",this.pattern=m(0),j("|"),this.update=m(0),E.id===","&&(j(","),this.delete=m(0)),j("|"),this});var he=function(s){var c;if(s.type==="function"&&!s.predicate){var R={type:"lambda",thunk:!0,arguments:[],position:s.position};R.body=s,c=R}else if(s.type==="condition")s.then=he(s.then),typeof s.else<"u"&&(s.else=he(s.else)),c=s;else if(s.type==="block"){var ee=s.expressions.length;ee>0&&(s.expressions[ee-1]=he(s.expressions[ee-1])),c=s}else c=s;return c},ie=0,ke=0,Le=[],fe=function(s,c){switch(s.type){case"name":case"wildcard":c.level--,c.level===0&&(typeof s.ancestor>"u"||(Le[c.index].slot.label=s.ancestor.label),s.ancestor=c,s.tuple=!0);break;case"parent":c.level++;break;case"block":s.expressions.length>0&&(s.tuple=!0,c=fe(s.expressions[s.expressions.length-1],c));break;case"path":s.tuple=!0;var R=s.steps.length-1;for(c=fe(s.steps[R--],c);c.level>0&&R>=0;)c=fe(s.steps[R--],c);break;default:throw{code:"S0217",token:s.type,position:s.position}}return c},K=function(s,c){if(typeof c.seekingParent<"u"||c.type==="parent"){var R=typeof c.seekingParent<"u"?c.seekingParent:[];c.type==="parent"&&R.push(c.slot),typeof s.seekingParent>"u"?s.seekingParent=R:Array.prototype.push.apply(s.seekingParent,R)}},ze=function(s){var c=s.steps.length-1,R=s.steps[c],ee=typeof R.seekingParent<"u"?R.seekingParent:[];R.type==="parent"&&ee.push(R.slot);for(var ge=0;ge<ee.length;ge++){var ce=ee[ge];for(c=s.steps.length-2;ce.level>0;){if(c<0){typeof s.seekingParent>"u"?s.seekingParent=[ce]:s.seekingParent.push(ce);break}for(var v=s.steps[c--];c>=0&&v.focus&&s.steps[c].focus;)v=s.steps[c--];ce=fe(v,ce)}}},J=function(s){var c;switch(s.type){case"binary":switch(s.value){case".":var R=J(s.lhs);R.type==="path"?c=R:c={type:"path",steps:[R]},R.type==="parent"&&(c.seekingParent=[R.slot]);var ee=J(s.rhs);ee.type==="function"&&ee.procedure.type==="path"&&ee.procedure.steps.length===1&&ee.procedure.steps[0].type==="name"&&c.steps[c.steps.length-1].type==="function"&&(c.steps[c.steps.length-1].nextFunction=ee.procedure.steps[0].value),ee.type==="path"?Array.prototype.push.apply(c.steps,ee.steps):(typeof ee.predicate<"u"&&(ee.stages=ee.predicate,delete ee.predicate),c.steps.push(ee)),c.steps.filter(function(x){if(x.type==="number"||x.type==="value")throw{code:"S0213",stack:new Error().stack,position:x.position,value:x.value};return x.type==="string"}).forEach(function(x){x.type="name"}),c.steps.filter(function(x){return x.keepArray===!0}).length>0&&(c.keepSingletonArray=!0);var ge=c.steps[0];ge.type==="unary"&&ge.value==="["&&(ge.consarray=!0);var ce=c.steps[c.steps.length-1];ce.type==="unary"&&ce.value==="["&&(ce.consarray=!0),ze(c);break;case"[":c=J(s.lhs);var v=c,b="predicate";if(c.type==="path"&&(v=c.steps[c.steps.length-1],b="stages"),typeof v.group<"u")throw{code:"S0209",stack:new Error().stack,position:s.position};typeof v[b]>"u"&&(v[b]=[]);var y=J(s.rhs);typeof y.seekingParent<"u"&&(y.seekingParent.forEach(x=>{x.level===1?fe(v,x):x.level--}),K(v,y)),v[b].push({type:"filter",expr:y,position:s.position});break;case"{":if(c=J(s.lhs),typeof c.group<"u")throw{code:"S0210",stack:new Error().stack,position:s.position};c.group={lhs:s.rhs.map(function(x){return[J(x[0]),J(x[1])]}),position:s.position};break;case"^":c=J(s.lhs),c.type!=="path"&&(c={type:"path",steps:[c]});var P={type:"sort",position:s.position};P.terms=s.rhs.map(function(x){var q=J(x.expression);return K(P,q),{descending:x.descending,expression:q}}),c.steps.push(P),ze(c);break;case":=":c={type:"bind",value:s.value,position:s.position},c.lhs=J(s.lhs),c.rhs=J(s.rhs),K(c,c.rhs);break;case"@":if(c=J(s.lhs),v=c,c.type==="path"&&(v=c.steps[c.steps.length-1]),typeof v.stages<"u"||typeof v.predicate<"u")throw{code:"S0215",stack:new Error().stack,position:s.position};if(v.type==="sort")throw{code:"S0216",stack:new Error().stack,position:s.position};s.keepArray&&(v.keepArray=!0),v.focus=s.rhs.value,v.tuple=!0;break;case"#":c=J(s.lhs),v=c,c.type==="path"?v=c.steps[c.steps.length-1]:(c={type:"path",steps:[c]},typeof v.predicate<"u"&&(v.stages=v.predicate,delete v.predicate)),typeof v.stages>"u"?v.index=s.rhs.value:v.stages.push({type:"index",value:s.rhs.value,position:s.position}),v.tuple=!0;break;case"~>":c={type:"apply",value:s.value,position:s.position},c.lhs=J(s.lhs),c.rhs=J(s.rhs);break;default:c={type:s.type,value:s.value,position:s.position},c.lhs=J(s.lhs),c.rhs=J(s.rhs),K(c,c.lhs),K(c,c.rhs)}break;case"unary":c={type:s.type,value:s.value,position:s.position},s.value==="["?c.expressions=s.expressions.map(function(x){var q=J(x);return K(c,q),q}):s.value==="{"?c.lhs=s.lhs.map(function(x){var q=J(x[0]);K(c,q);var re=J(x[1]);return K(c,re),[q,re]}):(c.expression=J(s.expression),s.value==="-"&&c.expression.type==="number"?(c=c.expression,c.value=-c.value):K(c,c.expression));break;case"function":case"partial":c={type:s.type,name:s.name,value:s.value,position:s.position},c.arguments=s.arguments.map(function(x){var q=J(x);return K(c,q),q}),c.procedure=J(s.procedure);break;case"lambda":c={type:s.type,arguments:s.arguments,signature:s.signature,position:s.position};var O=J(s.body);c.body=he(O);break;case"condition":c={type:s.type,position:s.position},c.condition=J(s.condition),K(c,c.condition),c.then=J(s.then),K(c,c.then),typeof s.else<"u"&&(c.else=J(s.else),K(c,c.else));break;case"transform":c={type:s.type,position:s.position},c.pattern=J(s.pattern),c.update=J(s.update),typeof s.delete<"u"&&(c.delete=J(s.delete));break;case"block":c={type:s.type,position:s.position},c.expressions=s.expressions.map(function(x){var q=J(x);return K(c,q),(q.consarray||q.type==="path"&&q.steps[0].consarray)&&(c.consarray=!0),q});break;case"name":c={type:"path",steps:[s]},s.keepArray&&(c.keepSingletonArray=!0);break;case"parent":c={type:"parent",slot:{label:"!"+ie++,level:1,index:ke++}},Le.push(c);break;case"string":case"number":case"value":case"wildcard":case"descendant":case"variable":case"regex":c=s;break;case"operator":if(s.value==="and"||s.value==="or"||s.value==="in")s.type="name",c=J(s);else if(s.value==="?")c=s;else throw{code:"S0201",stack:new Error().stack,position:s.position,token:s.value};break;case"error":c=s,s.lhs&&(c=J(s.lhs));break;default:var D="S0206";s.id==="(end)"&&(D="S0207");var A={code:D,position:s.position,token:s.value};if(k)return we.push(A),{type:"error",error:A};throw A.stack=new Error().stack,A}return s.keepArray&&(c.keepArray=!0),c};F=G($),j();var $e=m(0);if(E.id!=="(end)"){var We={code:"S0201",position:E.position,token:E.value};Z(We)}if($e=J($e),$e.type==="parent"||typeof $e.seekingParent<"u")throw{code:"S0217",token:$e.type,position:$e.position};return we.length>0&&($e.errors=we),$e};return X})();d.exports=h},{"./signature":5}],5:[function(a,d,p){var w=a("./utils");const h=(()=>{var U={a:"arrays",b:"booleans",f:"functions",n:"numbers",o:"objects",s:"strings"};function N(G){for(var X=1,$=[],k={},E=k;X<G.length;){var F=G.charAt(X);if(F===":")break;var oe=function(){$.push(k),E=k,k={}},we=function(L,te,ue,de){for(var he=1,ie=te;ie<L.length;)if(ie++,F=L.charAt(ie),F===de){if(he--,he===0)break}else F===ue&&he++;return ie};switch(F){case"s":case"n":case"b":case"l":case"o":k.regex="["+F+"m]",k.type=F,oe();break;case"a":k.regex="[asnblfom]",k.type=F,k.array=!0,oe();break;case"f":k.regex="f",k.type=F,oe();break;case"j":k.regex="[asnblom]",k.type=F,oe();break;case"x":k.regex="[asnblfom]",k.type=F,oe();break;case"-":E.context=!0,E.contextRegex=new RegExp(E.regex),E.regex+="?";break;case"?":case"+":E.regex+=F;break;case"(":var me=we(G,X,"(",")"),B=G.substring(X+1,me);if(B.indexOf("<")===-1)k.regex="["+B+"m]";else throw{code:"S0402",stack:new Error().stack,value:B,offset:X};k.type="("+B+")",X=me,oe();break;case"<":if(E.type==="a"||E.type==="f"){var S=we(G,X,"<",">");E.subtype=G.substring(X+1,S),X=S}else throw{code:"S0401",stack:new Error().stack,value:E.type,offset:X};break}X++}var Z="^"+$.map(function(L){return"("+L.regex+")"}).join("")+"$",j=new RegExp(Z),m=function(L){var te;if(w.isFunction(L))te="f";else{var ue=typeof L;switch(ue){case"string":te="s";break;case"number":te="n";break;case"boolean":te="b";break;case"object":L===null?te="l":Array.isArray(L)?te="a":te="o";break;case"undefined":default:te="m"}}return te},C=function(L,te){for(var ue="^",de=0,he=0;he<$.length;he++){ue+=$[he].regex;var ie=te.match(ue);if(ie===null)throw{code:"T0410",stack:new Error().stack,value:L[de],index:de+1};de=ie[0].length}throw{code:"T0410",stack:new Error().stack,value:L[de],index:de+1}};return{definition:G,validate:function(L,te){var ue="";L.forEach(function(ke){ue+=m(ke)});var de=j.exec(ue);if(de){var he=[],ie=0;return $.forEach(function(ke,Le){var fe=L[ie],K=de[Le+1];if(K==="")if(ke.context&&ke.contextRegex){var ze=m(te);if(ke.contextRegex.test(ze))he.push(te);else throw{code:"T0411",stack:new Error().stack,value:te,index:ie+1}}else he.push(fe),ie++;else K.split("").forEach(function(J){if(ke.type==="a"){if(J==="m")fe=void 0;else{fe=L[ie];var $e=!0;if(typeof ke.subtype<"u"){if(J!=="a"&&K!==ke.subtype)$e=!1;else if(J==="a"&&fe.length>0){var We=m(fe[0]);if(We!==ke.subtype.charAt(0))$e=!1;else{var s=fe.filter(function(c){return m(c)!==We});$e=s.length===0}}}if(!$e)throw{code:"T0412",stack:new Error().stack,value:fe,index:ie+1,type:U[ke.subtype]};J!=="a"&&(fe=[fe])}he.push(fe),ie++}else he.push(fe),ie++})}),he}C(L,ue)}}}return N})();d.exports=h},{"./utils":6}],6:[function(a,d,p){const w=(()=>{function h(S){var Z=!1;if(typeof S=="number"&&(Z=!isNaN(S),Z&&!isFinite(S)))throw{code:"D1001",value:S,stack:new Error().stack};return Z}function U(S){var Z=!1;return Array.isArray(S)&&(Z=S.filter(function(j){return typeof j!="string"}).length===0),Z}function N(S){var Z=!1;return Array.isArray(S)&&(Z=S.filter(function(j){return!h(j)}).length===0),Z}function G(){var S=[];return S.sequence=!0,arguments.length===1&&S.push(arguments[0]),S}function X(S){return S.sequence===!0&&Array.isArray(S)}function $(S){return S&&(S._jsonata_function===!0||S._jsonata_lambda===!0)||typeof S=="function"}function k(S){var Z=typeof S.arity=="number"?S.arity:typeof S.implementation=="function"?S.implementation.length:typeof S.length=="number"?S.length:S.arguments.length;return Z}function E(S){return S&&S._jsonata_lambda===!0}var F=(typeof Symbol=="function"?Symbol:{}).iterator||"@@iterator";function oe(S){return typeof S=="object"&&S!==null&&F in S&&"next"in S&&typeof S.next=="function"}function we(S,Z){if(S===Z)return!0;if(typeof S=="object"&&typeof Z=="object"&&S!==null&&Z!==null){if(Array.isArray(S)&&Array.isArray(Z)){if(S.length!==Z.length)return!1;for(var j=0;j<S.length;j++)if(!we(S[j],Z[j]))return!1;return!0}var m=Object.getOwnPropertyNames(S),C=Object.getOwnPropertyNames(Z);if(m.length!==C.length)return!1;for(m=m.sort(),C=C.sort(),j=0;j<m.length;j++)if(m[j]!==C[j])return!1;for(j=0;j<m.length;j++){var L=m[j];if(!we(S[L],Z[L]))return!1}return!0}return!1}function me(S){return typeof S=="object"&&S!==null&&"then"in S&&typeof S.then=="function"}function B(S){var Z=[];for(let j of S)Z.push(j);return Z}return{isNumeric:h,isArrayOfStrings:U,isArrayOfNumbers:N,createSequence:G,isSequence:X,isFunction:$,isLambda:E,isIterable:oe,getFunctionArity:k,isDeepEqual:we,stringToArray:B,isPromise:me}})();d.exports=w},{}]},{},[3])(3)})})(vn);var qn=vn.exports;const Wn=Hn(qn),jt=class jt{static setProps(n,a){n.__$bind_props__=a}static setData(n,a){n.__$bind_data__=a}static setDataProvider(n,a){n.__$bind_data_provider__=a}static setOptions(n,a){n.__$bind_data_options__=a}static getProps(n){return n.__$bind_props__==null&&this.setProps(n,{}),n.__$bind_props__}static getData(n){return n.__$bind_data__==null&&this.setData(n,{}),n.__$bind_data__}static getDataProvider(n){return n.__$bind_data_provider__==null&&this.setDataProvider(n,{}),n.__$bind_data_provider__}static getOptions(n){return n.__$bind_data_options__==null&&this.setOptions(n,{}),n.__$bind_data_options__}static async applyProps(n,a,d){const p=Object.keys(a);for(const w of p){const h=a[w];typeof h=="string"&&h.includes("{{")?n[w]=await this.resolveValue(a,w,d):typeof h=="object"?h===null?n[w]=null:Array.isArray(h)?(n[w]===void 0&&(n[w]=[]),await this.applyProps(n[w],h,d),n instanceof ht&&(n[w]=[...n[w]])):(n[w]===void 0&&(n[w]={}),await this.applyProps(n[w],h,d),n instanceof ht&&(n[w]={...n[w]})):n[w]=h}}static async resolveValue(n,a,d){let p=n[a];if(this.singleExpr.test(p)){const w=this.singleExpr.exec(p);w&&w[1]&&(p=await this.findValue(w[1],d))}else this.multiExpr.test(p)&&(p=await this.replaceAsync(p,this.multiExpr,async(w,h)=>await this.findValue(h,d)));return p}static async findValue(n,a){return await Wn(n).evaluate(a)??n}static async replaceAsync(n,a,d){const p=[];n.replace(a,(h,...U)=>{const N=d(h,...U);p.push(N)});const w=await Promise.all(p);return n.replace(a,()=>w.shift())}static async getDataByProviderAsync(n){return n.type==="webapi"?await this.getDataByWebApiAsync(n):(console.debug("unknown data provider type",n),{})}static async getDataByWebApiAsync(n){const a=n.url,d=n.method||"GET",p=n.headers||{},w=d!=="GET"&&d!=="HEAD"?JSON.stringify(n.body||{}):void 0;return await(await fetch(a,{method:d,headers:p,body:w})).json()}static async refreshData(n){const a=this.getDataProvider(n);if(a&&a.type){const d=await this.getDataByProviderAsync(a);this.setData(n,d),this.refresh(n)}}static startRefreshInterval(n,a){if(this.stopRefreshInterval(n),a>0){const d=this.getOptions(n);d.refreshId=setInterval(()=>{this.refreshData(n)},a)}}static stopRefreshInterval(n){const a=this.getOptions(n),d=a.refreshId;d&&(clearInterval(d),a.refreshId=void 0)}static async binding(n){const{target:a,props:d,data:p,dataProvider:w}=n;this.setProps(a,d),p&&this.setData(a,p),w&&this.updateDataProvider({target:a,dataProvider:w}),await this.refresh(a)}static async updateProps(n,a=!0){const{target:d,props:p}=n;this.setProps(d,p),a&&await this.refresh(d)}static async updateData(n,a=!0){const{target:d,data:p}=n;this.setData(d,p),a&&await this.refresh(d)}static async updateDataProvider(n){const{target:a,dataProvider:d}=n;this.setDataProvider(a,d),this.refreshData(a);const p=d.interval||0;this.startRefreshInterval(a,p)}static async refresh(n){const a=this.getProps(n),d=this.getData(n);await this.applyProps(n,a,d)}};jt.singleExpr=/^\{\{(.+?)\}\}$/,jt.multiExpr=/\{\{(.+?)\}\}/g;let on=jt;export{on as B,xe as T,wn as a,Yn as i,zn as n,Jn as r,ht as s,Gn as t,pt as w,Vn as x};
